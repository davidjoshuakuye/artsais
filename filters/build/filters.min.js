"use strict";function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var JEEFACEFILTERAPI=(window.JEEFACEFILTERAPIGEN=function(){function e(){var e=null,t=null,r=null,a=0;this.kd=function(t){return e[t]},this.Jd=function(i){var n=null;a=i.length,e=i.map((function(e,t){return e=Object.assign({},e,{index:t,parent:this,Na:n,td:t===a-1}),n=0===t?re.instance(e):ae.instance(e)})),t=e[0],r=e[a-1],e.forEach((function(e,t){0!==t&&e.Ed()}))},this.I=function(t,r){var a=r;return e.forEach((function(e){a=e.I(a,t)})),a},this.Tb=function(){return t.A()},this.Vb=function(){return r.ld()},this.Ld=function(e){r.Uc(e)},this.Sb=function(){return r.Sb()},this.h=function(){e&&(e.forEach((function(e){e.h()})),r=t=e=null,a=0)}}var t,r,a,i,n,o,u,l,s,c,d,f,v,E;function m(e,t){var r=t%8;return e[(t-r)/8]>>7-r&1}function h(){return-1!==[ve.play,ve.pause].indexOf(Ee)}function g(e){if(Ee!==ve.pause){var t=Ee===ve.play?ge.Aa:de.Ec;Se=setTimeout(R.bind(null,e),t)}}function p(){if(Ee===ve.play)return!1;Ee=ve.play,Oe.timestamp=Date.now(),De&&window.cancelAnimationFrame(De),R()}function x(){return Ee===ve.play&&(Se&&(clearTimeout(Se),Se=null),De&&(window.cancelAnimationFrame(De),De=null),Ee=ve.pause,!0)}function T(e,t,r,a,i){return e=4*(3*t+e)+r,a+(Ae.buffer[e]/255+Ae.buffer[e+12]/65025)*(i-a)}function b(){k.pixelStorei(k.UNPACK_FLIP_Y_WEBGL,!1),Q.U(),q.reset(),$.reset(),X.ka(),X.Mb(),k.disable(k.DEPTH_TEST),k.disable(k.BLEND),q.oa(),X.xa()}function R(){if(Ee!==ve.pause){if(X.Mb(),q.reset(),q.oa(),k.disable(k.DEPTH_TEST),k.pixelStorei(k.UNPACK_FLIP_Y_WEBGL,!1),Q.U(),X.xa(),!me.kb)e:{if(me.jb){if(!me.element.needsUpdate)break e;me.W.Xd(me.element.arrayBuffer),me.element.needsUpdate=!1}else{var e=me.element.currentTime,t=e-me.Oa;if(0>t&&(me.Oa=e),1e3*t<de.Zd)break e;me.Oa+=t,me.W.refresh()}X.set("s48"),me.ba.J(),me.W.b(0),q.g(!1,!1)}if(Me.L.length>Oe.F)Me.L.splice(0,Me.L.length-Oe.F);else for(;Me.L.length<Oe.F;)Me.L.push(0);if(1!==Me.i)if(ye.every(w)){for(var r=e=t=0;r<ye.length;++r)ye[r].detected>t&&(t=ye[r].detected,e=0);for(t=0;t<Oe.F;++t)Me.L[t]=e}else{for(e=Me.dc,t=0,r=!1;t<Oe.F;++t){if(w(ye[e]))if(r)do{++e===Me.i&&(e=0)}while(w(ye[e]));else r=!0;Me.L[t]=e++,e>=Me.i&&(e=0)}Me.dc=e}for(e=0;e<Oe.F;++e)Me.$=Me.L[e],Me.qb=(.5+Me.$)/Me.i,Me.ac=Me.L.lastIndexOf(Me.$)===e,X.set("s49"),ge.ga&&X.B("u36",ye[Me.$].rz),1!==Me.i&&X.B("u35",Me.qb),Fe.Ga.J(),me.ba.b(0),Ae.Qa.b(1),q.g(!1,!1),Fe.Ga.b(0),xe.I(!1,Fe.Ga);for(e=Date.now(),Oe.ra=e-Oe.timestamp,Oe.timestamp=e,-1!==Te.nDetectsPerLoop?Oe.F=Te.nDetectsPerLoop:(e=de.Ta,Oe.hc=Oe.ob/Oe.ra,Oe.ic=Oe.hc*e+Oe.ic*(1-e),Oe.kc=1e3/Oe.ra,Oe.ia=Oe.kc*de.Ta+Oe.ia*(1-de.Ta),Oe.ia>de.ea[1]?(e=de.za[1],1<Me.i&&(++e,t=ye.filter(y).length,e*=Math.max(1,t)),Oe.F=Math.min(Oe.F+1,e),Oe.ia=(de.ea[0]+de.ea[1])/2):Oe.ia<de.ea[0]&&(Oe.F=Math.max(Oe.F-1,de.za[0]),Oe.ia=(de.ea[0]+de.ea[1])/2)),Q.G(),k.viewport(0,0,3,2*Me.i),X.set("s47"),Ae.Qa.b(0),q.g(!1,!1),k.readPixels(0,0,3,2*Me.i,k.RGBA,k.UNSIGNED_BYTE,Ae.buffer),e=0;e<Me.i;++e)if(-1!==Me.L.indexOf(e)){var a=e;t=we[a];var i=[a];r=ye[a];var n=Ie[a],o=2*a;if(t.Da=T(1,o,3,0,1),r.detected=N.P(r.detected,t.Da,de.Bc),t.Da<de.nb)ge.ga&&(r.rz=0);else{var u=Ae.ya;for(t.x=T(0,o,1,-1,1),t.y=T(0,o,2,-1,1),t.T=T(0,o,3,0,1),t.tb=T(1,o,0,-u[0],u[0]),t.ub=T(1,o,1,-u[1],u[1]),t.va=T(1,o,2,-u[2],u[2]),u=0;u<Ae.R;++u)t.Ob[u]=Ae.ta[u](T(2,o,u,0,1));for(i.Za=t.x-r.x,i.$a=t.y-r.y,i.Ya=t.T-r.s,i.Va=t.tb-r.rx,i.Wa=t.ub-r.ry,i.Xa=ge.ga?t.va:t.va-r.rz,i=(1-G.Ia(be.translationFactorRange[0],be.translationFactorRange[1],Math.sqrt(i.Za*i.Za+i.$a*i.$a+i.Ya*i.Ya)/Oe.ra))*(1-G.Ia(be.rotationFactorRange[0],be.rotationFactorRange[1],Math.sqrt(i.Va*i.Va+i.Wa*i.Wa+i.Xa*i.Xa)/Oe.ra))*G.Ia(be.qualityFactorRange[0],be.qualityFactorRange[1],t.Da),a=n[++Ce[a]%n.length]=i,o=0;o<n.length;++o)a=Math.min(a,n[o]);for(a=Math.max(.5,a),i=Math.min(a,i),n=N.P(be.alphaRange[1],be.alphaRange[0],Math.pow(i,de.Dc)),r.x=N.P(r.x,t.x,n),r.y=N.P(r.y,t.y,n),r.s=N.P(r.s,t.T,n),r.rx=N.P(r.rx,t.tb,n),r.ry=N.P(r.ry,t.ub,n),r.rz=ge.ga?r.rz+n*t.va:N.P(r.rz,t.va,n),n=Math.max(n,de.Cc),a=0;a<Ae.R;++a)r.expressions[a]=N.P(r.expressions[a],t.Ob[a],n);++t.La}}Q.Wd(),Q.reset(),$.reset(),k.enable(k.DEPTH_TEST),ge.Ca&&(1===Me.i?ge.Ca(ye[0]):ge.Ca(ye)),k.disable(k.BLEND),Ee===ve.play&&(De=window.requestAnimationFrame(g))}}function F(){X.K("s49",[{type:"1i",name:"u1",value:0},{type:"1i",name:"u33",value:1},{type:"2f",name:"u34",value:Fe.v},{type:"1f",name:"u35",value:.5},{type:"1f",name:"u36",value:0}]),X.K("s50",[{type:"1i",name:"u37",value:0},{type:"1i",name:"u33",value:1},{type:"1f",name:"u40",value:de.Ud},{type:"1f",name:"u41",value:de.yc},{type:"1f",name:"u42",value:de.xc},{type:"3f",name:"u39",value:[Ae.ca[0]*Fe.v[0],Ae.ca[1]*Fe.v[1],Ae.ca[2]]},{type:"1f",name:"u35",value:.5},{type:"1f",name:"u43",value:1},{type:"1f",name:"u36",value:0}]);var e=[{type:"1i",name:"u37",value:0}];X.K("s51",e),X.K("s52",e),X.K("s47",[{type:"1i",name:"u33",value:0},{type:"1f",name:"u46",value:Fe.v[0]},{type:"2f",name:"u45",value:[0,.5/Me.i]}])}function _(){var e=xe.Tb(),m=Fe.M/e;o=Te.minScale*m,u=Te.maxScale*m,l=(1-2*Te.borderWidth)/Te.nStepsX,s=(1-2*Te.borderHeight)/Te.nStepsY,c=(u-o)/Te.nStepsScale,d=Te.borderWidth,f=Te.borderHeight,v=1-Te.borderWidth,E=1-Te.borderHeight,Fe.v[0]=e/Fe.M,Fe.v[1]=e/Fe.O,t=Te.borderWidth,r=Te.borderHeight,a=o,i=Te.borderWidth,n=Te.borderHeight,Re=o}function A(e,t){if(e.exportData){var r=e.exportData;r.thetaXYZfactor&&(Ae.ya=r.thetaXYZfactor),r.trackingDxysFactor&&(Ae.ca=r.trackingDxysFactor),void 0!==r.nExpressions&&(Ae.R=r.nExpressions)}if(Ae.R||(Ae.R=de.jc),!Ae.ta)for(Ae.ta=[],r=0;r<Ae.R;++r)Ae.ta.push(de.dd);t(e)}function w(e){return e.detected<=de.nb}function y(e){return e.detected>de.nb}function S(e,t,r,a){return r>e?Math.max(0,e+t/2-(r-a/2)):Math.max(0,r+a/2-(e-t/2))}function D(){var e=Me.$;if(Ae.Qa.Nd(1),1!==Me.i&&(k.viewport(0,0,3,Me.i),X.set("s0"),X.rc("u1",1),q.g(!1,!1),X.rc("u1",0)),k.viewport(0,e,1,1),X.set("s50"),ge.ga&&X.B("u36",ye[e].rz),1!==Me.i&&X.B("u35",Me.qb),1<Me.i){var m=we.some((function(e,t){if(t===Me.$)return!1;if((t=we[Me.$]).La>e.La||3>e.La||S(t.x,t.T,e.x,e.T)<de.ec*t.T)return!1;var r=Fe.M/Fe.O;return S(t.y,t.T*r,e.y,e.T*r)>de.ec*t.T*r}))?0:1;X.B("u43",m)}X.Pd("u38",i,n,Re),q.g(!1,!1),Me.ac&&(k.viewport(1,e,1,1),X.set("s51"),q.g(!1,!1),k.viewport(2,e,1,1),X.set("s52"),q.g(!1,!1)),(a+=c)>u&&(a=o,(t+=l)>v&&(t=d,(r+=s)>E&&(r=f))),i=t+.5*(Math.random()-.5)*l,n=r+.5*(Math.random()-.5)*s,Re=a+.5*(Math.random()-.5)*c}function M(){me.W&&me.W.remove(),me.jb=!!me.element.isFakeVideo,me.W=$.instance(Object.assign({isPot:!1,isFloat:!1},me.jb?{isFlipY:!1,array:me.element.arrayBuffer,width:me.element.videoWidth,height:me.element.videoHeight,isKeepArray:!0}:{D:me.element}))}function O(){X.K("s48",[{type:"1i",name:"u1",value:0},{type:"mat2",name:"u32",value:me.m}])}function I(){me.C[0]=.5,me.C[1]=.5;var e=me.v[1]/me.v[0],t=j.N()/j.A();switch(90===Math.abs(fe.rotate)&&(e=1/e),e>t?me.C[1]*=t/e:me.C[0]*=e/t,X.K("s50",[{name:"u44",type:"1f",value:t}]),me.m[0]=0,me.m[1]=0,me.m[2]=0,me.m[3]=0,fe.rotate){case 0:me.m[0]=me.C[0],me.m[3]=me.C[1];break;case 180:me.m[0]=-me.C[0],me.m[3]=-me.C[1];break;case 90:me.m[1]=me.C[0],me.m[2]=-me.C[1];break;case-90:me.m[1]=-me.C[0],me.m[2]=me.C[1]}fe.flipX&&(me.m[0]*=-1,me.m[2]*=-1)}function C(){var e=me.element.videoWidth,t=me.element.videoHeight,r=me.v[0]!==e||me.v[1]!==t;return r&&(me.v[0]=e,me.v[1]=t),r}function L(e,t){return Ee!==ve.error&&(me.element=e,C(),t&&t(),!0)}function U(e,t,r){e&&e(),me.qa={video:{facingMode:{ideal:fe.facingMode},width:{min:fe.minWidth,max:fe.maxWidth,ideal:fe.idealWidth},height:{min:fe.minHeight,max:fe.maxHeight,ideal:fe.idealHeight}},audio:!1},fe.deviceId&&(me.qa.deviceId=fe.deviceId),ce.get(me.element?me.element:ce.nd(),(function(e){t&&t(e),r(e)}),(function(){B("WEBCAM_UNAVAILABLE")}),me.qa)}function B(e){Ee!==ve.error&&(Ee=ve.error,ge.pa&&ge.pa(e))}var P,N={Te:function(e){return Math.ceil(Math.log2(e))},wd:function(e){return Math.log2(e)},ff:function(e){return(e=Math.log2(e))===Math.floor(e)},he:function(e){var t=[0,0,0,0];return e.forEach((function(e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],t[3]+=e[3]})),t},ie:function(e,t,r){return Math.min(Math.max(e,t),r)},me:function(e){return e*Math.PI/180},mf:function(e,t){return t=Math.pow(10,t),Math.round(e*t)/t},pf:function(e){return Math.round(1e6*e)/1e6},Ue:function(e,t){return(100*e/t).toFixed(3)},P:function(e,t,r){return e*(1-r)+t*r},Zc:function(e,t){return N.Qc(e-t)},Qc:function(e){for(;e>Math.PI;)e-=2*Math.PI;for(;e<=-Math.PI;)e+=2*Math.PI;return e},pe:function(e,t){return Math.abs(N.Zc(e,t))},$d:function(e,t){return Math.atan2(Math.sin(e)+Math.sin(t),Math.cos(e)+Math.cos(t))}},H={get:function(e,t,r){var a=new XMLHttpRequest;a.open("GET",e,!0),a.withCredentials=!1,a.onreadystatechange=function(){4===a.readyState&&(200===a.status||0===a.status?t(a.responseText):void 0!==r&&r(a.status))},a.send()},Pe:function(e,t){H.get(e,(function(e){t(JSON.parse(e))}))},kf:function(e,t,r){var a=new XMLHttpRequest;a.open("POST",e,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){4!==a.readyState||200!==a.status&&0!==a.status||r(a.responseText)},a.send(t)},Ge:function(e,t){var r=new XMLHttpRequest;r.open("POST",e,!0),r.responseType="arraybuffer",r.onload=function(){t(r.response)},r.send()}},G={Af:function(e,t,r){return(e=Math.min(Math.max((r-e)/(t-e),0),1))*e*(3-2*e)},Ia:function(e,t,r){return Math.min(Math.max((r-e)/(t-e),0),1)},Ae:function(e,t,r,a){return Math.pow(Math.min(Math.max((a-e)/(t-e),0),1),r)},Ef:function(){return 0},jf:function(){return 1},hf:function(e){return e},xe:function(e){return e*e},Ce:function(e){return e*(2-e)},ue:function(e){return.5>e?2*e*e:(4-2*e)*e-1},se:function(e){return e*e*e},Be:function(e){return--e*e*e+1},te:function(e){return.5>e?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},ye:function(e){return e*e*e*e},De:function(e){return 1- --e*e*e*e},ve:function(e){return.5>e?8*e*e*e*e:1-8*--e*e*e*e},ze:function(e){return e*e*e*e*e},Ee:function(e){return 1+--e*e*e*e*e},we:function(e){return.5>e?16*e*e*e*e*e:1+16*--e*e*e*e*e}},z=function(e,t,r){switch(e){case"relu":return r+"=max(vec4(0.,0.,0.,0.),"+t+");";case"elu":return r+"=mix(exp(-abs("+t+"))-vec4(1.,1.,1.,1.),"+t+",step(0.,"+t+"));";case"elu01":return r+"=mix(0.1*exp(-abs("+t+"))-vec4(0.1,0.1,0.1,0.1),"+t+",step(0.,"+t+"));";case"arctan":return r+"=atan(3.14159265359*texture2D(u0,vUV))/3.14159265359;";case"copy":return"";default:return!1}},X=function(){function e(e,t){return e=k.createShader(e),k.shaderSource(e,t),k.compileShader(e),!!k.getShaderParameter(e,k.COMPILE_STATUS)&&e}function t(t){if(void 0===t.da&&(t.da="precision lowp float;attribute vec2 a0;varying vec2 vv0;void main(){gl_Position=vec4(a0,0.,1.),vv0=a0*.5+vec2(.5,.5);}"),void 0===t.Ba&&(t.Ba=["a0"]),void 0===t.ma&&(t.ma=[2]),void 0!==t.precision&&"highp"!==t.precision||(t.precision=u),t.id=n++,void 0!==t.Id&&t.Id.forEach((function(e,r){t.a=t.a.replace(e,t.Pa[r])})),t.yb=0,t.ma.forEach((function(e){t.yb+=4*e})),t.ua=function(t,a){t=e(k.VERTEX_SHADER,t),a=e(k.FRAGMENT_SHADER,a),r.push(t,a);var i=k.createProgram();return k.attachShader(i,t),k.attachShader(i,a),k.linkProgram(i),i}(t.da,"precision "+t.precision+" float;\n"+t.a),t.j={},t.c.forEach((function(e){t.j[e]=k.getUniformLocation(t.ua,e)})),t.attributes={},t.na=[],t.Ba.forEach((function(e){var r=k.getAttribLocation(t.ua,e);t.attributes[e]=r,t.na.push(r)})),t.f)for(var o in k.useProgram(t.ua),i=t,a=t.id,t.f)k.uniform1i(t.j[o],t.f[o]);t.hb=!0}var r=[],a=-1,i=null,n=0,o=!1,u="highp",l=["u1"],s=["u0"],c={u1:0},d={u0:0},f={u1:0,u2:1},v={u3:0},E={s0:{a:"uniform sampler2D u1;varying vec2 vv0;void main(){gl_FragColor=texture2D(u1,vv0);}",c:l,f:c},s1:{a:"uniform sampler2D u1;varying vec2 vv0;void main(){gl_FragColor=texture2D(u1,vv0);}",c:l,f:c,precision:"lowp"},s2:{a:"uniform sampler2D u1,u2;varying vec2 vv0;void main(){vec4 a=texture2D(u2,vv0),b=texture2D(u1,vv0);gl_FragColor=a*b;}",c:["u1","u2"],f:f},s3:{a:"uniform sampler2D u1;varying vec2 vv0;const vec4 f=vec4(1.,1.,1.,1.);void main(){vec4 a=texture2D(u1,vv0);gl_FragColor=a.r*f;}",c:l,f:c},s4:{a:"uniform sampler2D u1,u2;varying vec2 vv0;const vec4 f=vec4(1.,1.,1.,1.);void main(){vec4 a=texture2D(u2,vv0),b=texture2D(u1,vv0);gl_FragColor=a.a*b.r*f;}",c:["u1","u2"],f:f},s5:{a:"uniform sampler2D u1;varying vec2 vv0;void main(){gl_FragColor=texture2D(u1,vec2(1.-vv0.x,vv0.y));}",c:l,f:c},s6:{a:"uniform sampler2D u1;varying vec2 vv0;void main(){gl_FragColor=texture2D(u1,vec2(vv0.x,1.-vv0.y));}",c:l,f:c},s7:{a:"uniform sampler2D u0;uniform float u4;varying vec2 vv0;void main(){vec4 a=texture2D(u0,vv0);gl_FragColor=a*u4;}",c:["u0","u4"],f:d},s8:{a:"uniform sampler2D u0;uniform float u4;varying vec2 vv0;const vec4 f=vec4(.25,.25,.25,.25),g=vec4(1.,1.,1.,1.);void main(){vec4 a=texture2D(u0,vv0);float b=dot(a*u4,f);gl_FragColor=b*g;}",c:["u0","u4"],f:d},s9:{a:"uniform sampler2D u1;varying vec2 vv0;const vec4 e=vec4(1.,1.,1.,1.);void main(){float a=.25*dot(e,texture2D(u1,vv0));gl_FragColor=a*e;}",c:l,f:c},s10:{a:"uniform sampler2D u1,u5;uniform float u6;const vec4 f=vec4(1.,1.,1.,1.);varying vec2 vv0;void main(){vec4 a=texture2D(u1,vv0),b=texture2D(u5,vv0);gl_FragColor=mix(b,a,u6*f);}",c:["u1","u5","u6"],f:{u1:0,u5:1}},s11:{a:"uniform sampler2D u1;uniform vec2 u7;varying vec2 vv0;void main(){gl_FragColor=.25*(texture2D(u1,vv0+u7)+texture2D(u1,vv0+u7*vec2(1.,-1.))+texture2D(u1,vv0+u7*vec2(-1.,-1.))+texture2D(u1,vv0+u7*vec2(-1.,1.)));}",c:["u1","u7"],f:c},s12:{a:"uniform sampler2D u1;uniform vec4 u8;varying vec2 vv0;float g(float a,float b){a=floor(a)+.5;return floor(a/exp2(b));}float h(float a,float b){return floor(a*exp2(b)+.5);}float i(float a,float b){return mod(a,h(1.,b));}float e(float c,float a,float b){a=floor(a+.5),b=floor(b+.5);return i(g(c,a),b-a);}vec4 j(float a){if(a==0.)return vec4(0.,0.,0.,0.);float k=128.*step(a,0.);a=abs(a);float c=floor(log2(a)),l=c+127.,b=(a/exp2(c)-1.)*8388608.,d=l/2.,m=fract(d)*2.,n=floor(d),o=e(b,0.,8.),p=e(b,8.,16.),q=m*128.+e(b,16.,23.),r=k+n;return vec4(o,p,q,r)/255.;}void main(){float a=dot(texture2D(u1,vv0),u8);gl_FragColor=j(a);}",c:["u1","u8"],f:c},s13:{a:"uniform sampler2D u0;varying vec2 vv0;const vec4 e=vec4(1.,1.,1.,1.);void main(){vec4 a=texture2D(u0,vv0),b=e/(e+exp(-a));gl_FragColor=b;}",c:s,f:d},s14:{a:"uniform sampler2D u0;varying vec2 vv0;const vec4 f=vec4(0.,0.,0.,0.);void main(){vec4 a=texture2D(u0,vv0);gl_FragColor=max(f,a);}",c:s,f:d},s15:{a:"uniform sampler2D u0;varying vec2 vv0;const vec4 f=vec4(1.,1.,1.,1.);void main(){vec4 a=texture2D(u0,vv0);gl_FragColor=mix(exp(-abs(a))-f,a,step(0.,a));}",c:s,f:d},s16:{a:"uniform sampler2D u0;varying vec2 vv0;const vec4 f=vec4(1.,1.,1.,1.);void main(){vec4 a=texture2D(u0,vv0),b=exp(-abs(a))-f;gl_FragColor=mix(.1*b,a,step(0.,a));}",c:s,f:d},s17:{a:"uniform sampler2D u0,u6,u9;varying vec2 vv0;const vec4 f=vec4(1.,1.,1.,1.);void main(){vec4 a=texture2D(u0,vv0),c=texture2D(u6,vv0),d=texture2D(u9,vv0),b=a/d;gl_FragColor=c*mix(exp(-abs(b))-f,b,step(0.,a));}",c:["u0","u6","u9"],f:{u0:0,u6:1,u9:2}},s18:{a:"uniform sampler2D u0;const float e=3.141593;varying vec2 vv0;void main(){gl_FragColor=atan(e*texture2D(u0,vv0))/e;}",c:s,f:d},s19:{a:"uniform sampler2D u0;varying vec2 vv0;const vec4 f=vec4(1.,1.,1.,1.);void main(){vec4 a=texture2D(u0,vv0),b=log(f+a);gl_FragColor=b;}",c:s,f:d},s20:{a:"uniform sampler2D u0,u10;uniform float u11;const vec2 e=vec2(.5,.5);const float f=1e-5;const vec4 g=vec4(1.,1.,1.,1.),i=vec4(0.,0.,0.,0.);varying vec2 vv0;void main(){vec4 a=texture2D(u10,e);float b=u11*u11;vec4 c=max(b*a,f*g);gl_FragColor=texture2D(u0,vv0)/c;}",c:["u0","u10","u11"],f:{u0:0,u10:1}},s21:{a:"uniform sampler2D u1;uniform vec2 u12;varying vec2 vv0;void main(){float a=u12.x*u12.y;vec2 b=floor(vv0*a)/a,c=fract(vv0*a),d=floor(b*u12.y),f=floor(u12.x*fract(b*u12.y)),g=(f*u12.y+d)/a;gl_FragColor=texture2D(u1,g+c/a);}",c:["u1","u12"],f:c},s22:{a:"uniform sampler2D u13,u14,u15;varying vec2 vv0;void main(){vec4 a=texture2D(u15,vv0);vec2 b=a.rg,c=a.ba;vec4 d=texture2D(u13,b),f=texture2D(u14,c);gl_FragColor=d*f;}",c:["u13","u14","u15"],f:{u14:0,u13:1,u15:2}},s23:{a:"uniform float u16;uniform sampler2D u13,u14;varying vec2 vv0;void main(){vec2 a=fract(vv0*u16);vec4 b=texture2D(u13,vv0),c=texture2D(u14,a);gl_FragColor=b*c;}",c:["u14","u13","u16"],f:{u14:0,u13:1}},s24:{a:"uniform float u16;uniform sampler2D u13,u14,u17,u18,u19,u20;varying vec2 vv0;const vec4 e=vec4(1.,1.,1.,1.),g=vec4(1e-3,1e-3,1e-3,1e-3);void main(){vec2 h=vv0*u16,l=floor(h),c=h-l;vec4 m=texture2D(u13,vv0),d=texture2D(u14,c),a=texture2D(u20,vv0);a=a*255.;vec4 n=texture2D(u17,c),o=texture2D(u18,c),p=texture2D(u19,c),i=step(-g,-a),b=e-i,j=b*step(-e-g,-a);b*=e-j;vec4 k=b*step(-2.*e-g,-a);b*=e-k;vec4 q=b;d=i*d+j*n+k*o+q*p,gl_FragColor=m*d;}",c:"u13 u14 u16 u20 u17 u18 u19".split(" "),f:{u14:0,u13:1,u20:3,u17:4,u18:5,u19:6}},s25:{a:"uniform sampler2D u13,u14,u21;uniform float u16,u22,u23,u24;varying vec2 vv0;const vec2 j=vec2(1.,1.);void main(){vec2 a=floor(u22*vv0),b=u22*vv0-a;float c=u16/u22;vec2 d=floor(b*c),f=b*c-d,g=(a+f)/u22;float k=u22*u24/u16;vec2 l=k*d,h=(l+f*u23)/u24,i=step(h,j);vec4 m=texture2D(u13,g),n=texture2D(u14,h),o=m*n*i.x*i.y,p=texture2D(u21,g);gl_FragColor=o*u23*u23+p;}",c:"u13 u14 u16 u22 u23 u24 u21".split(" "),f:{u14:0,u13:1,u21:2}},s26:{a:"uniform sampler2D u13,u14;varying vec2 vv0;void main(){vec4 a=texture2D(u13,vv0),b=texture2D(u14,vv0);gl_FragColor=a*b;}",c:["u13","u14"],f:{u14:0,u13:1}},s27:{a:"uniform sampler2D u1,u21;uniform float u25;varying vec2 vv0;void main(){gl_FragColor=texture2D(u21,vv0)+u25*texture2D(u1,vv0);}",c:["u1","u21","u25"],f:{u1:0,u21:1}},s28:{a:"varying vec2 vv0;uniform sampler2D u1;const vec4 f=vec4(1.,1.,1.,1.),g=vec4(.299,.587,.114,0.);void main(){vec4 a=texture2D(u1,vv0);gl_FragColor=dot(a,g)*f;}",c:l,f:c,precision:"lowp"},s29:{a:"varying vec2 vv0;uniform sampler2D u1;uniform float u26;const vec3 f=vec3(.299,.587,.114);void main(){vec3 a=texture2D(u1,vv0).rgb,b=texture2D(u1,vv0+vec2(0.,u26)).rgb,c=texture2D(u1,vv0+vec2(u26,u26)).rgb,d=texture2D(u1,vv0+vec2(u26,0.)).rgb;gl_FragColor=vec4(dot(a,f),dot(b,f),dot(c,f),dot(d,f));}",c:["u1","u26"],f:c,precision:"lowp"},s30:{a:"varying vec2 vv0;uniform sampler2D u1;uniform float u26;const vec3 f=vec3(.299,.587,.114);void main(){vec3 a=texture2D(u1,vv0).rgb,b=texture2D(u1,vv0+vec2(0.,u26)).rgb,c=texture2D(u1,vv0+vec2(u26,u26)).rgb,d=texture2D(u1,vv0+vec2(u26,0.)).rgb;gl_FragColor=vec4(a.r,b.g,c.b,dot(d,f));}",c:["u1","u26"],f:c,precision:"lowp"},s31:{a:"varying vec2 vv0;uniform sampler2D u1,u2;uniform float u27;const vec4 f=vec4(1.,1.,1.,1.);void main(){vec4 a=vec4(0.);a-=texture2D(u1,vec2(vv0.x-u27,vv0.y-u27))*1.,a-=texture2D(u1,vec2(vv0.x-u27,vv0.y))*2.,a-=texture2D(u1,vec2(vv0.x-u27,vv0.y+u27))*1.,a+=texture2D(u1,vec2(vv0.x+u27,vv0.y-u27))*1.,a+=texture2D(u1,vec2(vv0.x+u27,vv0.y))*2.,a+=texture2D(u1,vec2(vv0.x+u27,vv0.y+u27))*1.;vec4 b=vec4(0.);b-=texture2D(u1,vec2(vv0.x-u27,vv0.y-u27))*1.,b-=texture2D(u1,vec2(vv0.x,vv0.y-u27))*2.,b-=texture2D(u1,vec2(vv0.x+u27,vv0.y-u27))*1.,b+=texture2D(u1,vec2(vv0.x-u27,vv0.y+u27))*1.,b+=texture2D(u1,vec2(vv0.x,vv0.y+u27))*2.,b+=texture2D(u1,vec2(vv0.x+u27,vv0.y+u27))*1.;vec3 c=sqrt(a.rgb*a.rgb+b.rgb*b.rgb);vec4 e=vec4(c,texture2D(u1,vv0).a),g=texture2D(u2,vv0);gl_FragColor=g.a*e.r*f;}",c:["u1","u2","u27"],f:f},s32:{a:"varying vec2 vv0;uniform sampler2D u1,u2;uniform float u27;const vec4 j=vec4(1.,1.,1.,1.);const vec2 k=vec2(1.,1.);void main(){float h=0.;vec2 l=k*u27,a,b;float c,d,i=0.;for(float e=-4.;e<=4.;e+=1.)for(float f=-4.;f<=4.;f+=1.)a=vec2(e,f),c=length(a)/2.,d=exp(-c*c),b=vv0+l*a,h+=d*texture2D(u1,b).r,i+=d;vec4 m=texture2D(u2,vv0);gl_FragColor=m.a*(texture2D(u1,b).r-h/i)*j;}",c:["u1","u2","u27"],f:f},s33:{a:"uniform sampler2D u3;uniform vec2 u7;varying vec2 vv0;vec4 e(vec4 a,vec4 b){vec4 c=step(a,b);return mix(a,b,c);}const vec2 g=vec2(.5,.5),h=vec2(1.,0.),i=vec2(0.,1.);void main(){vec2 a=vv0-u7*g;vec4 b=texture2D(u3,a),c=texture2D(u3,a+u7*h),d=texture2D(u3,a+u7*i),j=texture2D(u3,a+u7),k=e(b,c),l=e(d,j);gl_FragColor=e(k,l);}",c:["u3","u7"],f:v},s34:{a:"uniform sampler2D u3;uniform vec2 u7;varying vec2 vv0;const vec2 k=vec2(1.,0.),l=vec2(0.,1.),m=vec2(2.,0.),n=vec2(0.,2.);vec4 e(vec4 a,vec4 b){vec4 c=step(a,b);return mix(a,b,c);}vec4 f(vec2 a){vec4 b=texture2D(u3,a),c=texture2D(u3,a+u7*k),d=texture2D(u3,a+u7*l),g=texture2D(u3,a+u7),h=e(b,c),i=e(d,g);return e(h,i);}void main(){vec2 a=vv0+u7*vec2(-.55,-1.05);vec4 b=f(a),c=f(a+u7*m),d=f(a+u7*2.),g=f(a+u7*n),h=e(b,c),i=e(d,g);gl_FragColor=e(h,i);}",c:["u3","u7"],f:v},s35:{a:"uniform sampler2D u1;varying vec2 vv0;void main(){vec4 a=texture2D(u1,vv0);gl_FragColor=a*a;}",c:["u1"],f:c,precision:"lowp"},s36:{a:"uniform sampler2D u1;uniform vec2 u7;varying vec2 vv0;const float e=15444.;void main(){vec4 a=1001./e*texture2D(u1,vv0-3.*u7)+2002./e*texture2D(u1,vv0-2.*u7)+3003./e*texture2D(u1,vv0-u7)+3432./e*texture2D(u1,vv0)+3003./e*texture2D(u1,vv0+u7)+2002./e*texture2D(u1,vv0+2.*u7)+1001./e*texture2D(u1,vv0+3.*u7);gl_FragColor=a;}",c:["u7","u1"],f:c,precision:"lowp"},s37:{a:"uniform sampler2D u1,u28,u29;varying vec2 vv0;const vec4 f=vec4(1.,1.,1.,1.);const float g=.1;void main(){vec4 a=texture2D(u28,vv0),b=texture2D(u29,vv0),c=texture2D(u1,vv0),d=max(f*g,b-a*a),h=sqrt(d);gl_FragColor=(c-a)/h;}",c:["u1","u28","u29"],f:{u1:0,u28:1,u29:2}}},m={s38:{a:"uniform float u16,u30;uniform sampler2D u13,u14,u21;varying vec2 vv0;const vec2 ZERO2=vec2(0.,0.),ONE2=vec2(1.,1.),HALF2=vec2(.5,.5),EPS2=vec2(1e-5,1e-5);void main(){vec4 sum=texture2D(u21,vv0);float toSparsity=1.1111;vec2 uvFrom,uvWeight,xyPatch=ZERO2,eps2=EPS2/u16,xyTo=floor(vv0*u16+eps2);float weightSize=toSparsity*u16;vec2 halfFromSparsity=ONE2*(toSparsity-1.)/2.;for(float patch_x=0.;patch_x<1.1111;patch_x+=1.){xyPatch.x=patch_x;for(float patch_y=0.;patch_y<1.1111;patch_y+=1.)xyPatch.y=patch_y,uvFrom=(xyTo+HALF2+u30*(xyPatch-halfFromSparsity))/u16,uvFrom+=step(uvFrom,-eps2),uvFrom-=step(ONE2-eps2,uvFrom),uvWeight=(xyTo*toSparsity+xyPatch+HALF2)/weightSize,sum+=texture2D(u13,uvWeight)*texture2D(u14,uvFrom);}gl_FragColor=sum,gl_FragColor*=2.2222;}",c:["u16","u13","u14","u21","u30"],Pa:["1.1111","gl_FragColor\\*=2.2222;"]},s39:{a:"uniform float u16,u30,u24;uniform sampler2D u13,u14,u21;varying vec2 vv0;const vec2 ZERO2=vec2(0.,0.),ONE2=vec2(1.,1.),HALF2=vec2(.5,.5),EPS2=vec2(1e-4,1e-4);void main(){vec4 sum=texture2D(u21,vv0);float fromSparsity=1.1111,shrinkFactor=3.3333;vec2 uvFrom,uvWeight,xyFrom,xyPatchTo,xyPatch=ZERO2,xyShrink=ZERO2,eps2=EPS2/u24,xyTo=floor(vv0*u16+eps2);float weightSize=fromSparsity*u24;vec2 halfFromSparsity=ONE2*(fromSparsity-1.)/2.;float toSparsity=weightSize/u16;vec2 xyFrom0=xyTo*shrinkFactor;for(float patch_x=0.;patch_x<1.1111;patch_x+=1.){xyPatch.x=patch_x;for(float patch_y=0.;patch_y<1.1111;patch_y+=1.){xyPatch.y=patch_y;for(float shrink_x=0.;shrink_x<3.3333;shrink_x+=1.){xyShrink.x=shrink_x;for(float shrink_y=0.;shrink_y<3.3333;shrink_y+=1.)xyShrink.y=shrink_y,xyFrom=xyFrom0+xyShrink+shrinkFactor*u30*(xyPatch-halfFromSparsity),uvFrom=(xyFrom+HALF2)/u24,uvFrom+=step(uvFrom,-eps2),uvFrom-=step(ONE2-eps2,uvFrom),xyPatchTo=xyPatch*shrinkFactor+xyShrink,uvWeight=(xyTo*toSparsity+xyPatchTo+HALF2)/weightSize,sum+=texture2D(u13,uvWeight)*texture2D(u14,uvFrom);}}}gl_FragColor=sum,gl_FragColor*=2.2222;}",c:"u16 u24 u13 u14 u21 u30".split(" "),Pa:["1.1111","gl_FragColor\\*=2.2222;","3.3333"]}},h={lb:function(){return o},o:function(){if(!o){for(var e in u="highp",E)t(E[e]);return X.set("s0"),k.enableVertexAttribArray(0),e=ee.o(),o=!0,e}},Ac:function(e){e.forEach((function(e){h.Bb(e)}))},Bb:function(e){E[e.id]=e,t(e,e.id)},Xb:function(e,r,a){r||(r=e),E[r]=Object.create(m[e]),E[r].sd=!0,m[e].Pa&&m[e].Pa.forEach((function(e,t){E[r].a=E[r].a.replace(new RegExp(e,"g"),a[t])})),t(E[r])},set:function(e){!function(e){Y.Od(h),a!==e.id&&(h.ka(),a=e.id,i=e,k.useProgram(e.ua),e.na.forEach((function(e){0!==e&&k.enableVertexAttribArray(e)})))}(E[e])},cd:function(e){return void 0!==E[e]&&E[e].hb},ka:function(){-1!==a&&(a=-1,i.na.forEach((function(e){0!==e&&k.disableVertexAttribArray(e)})))},wb:function(){var e=0;i.na.forEach((function(t,r){r=i.ma[r],k.vertexAttribPointer(t,r,k.FLOAT,!1,i.yb,e),e+=4*r}))},Mb:function(){k.enableVertexAttribArray(0)},xa:function(){k.vertexAttribPointer(i.na[0],2,k.FLOAT,!1,8,0)},rc:function(e,t){k.uniform1i(i.j[e],t)},B:function(e,t){k.uniform1f(i.j[e],t)},wa:function(e,t,r){k.uniform2f(i.j[e],t,r)},uf:function(e,t){k.uniform2fv(i.j[e],t)},vf:function(e,t){k.uniform3fv(i.j[e],t)},Pd:function(e,t,r,a){k.uniform3f(i.j[e],t,r,a)},wf:function(e,t,r,a,n){k.uniform4f(i.j[e],t,r,a,n)},vb:function(e,t){k.uniform4fv(i.j[e],t)},xf:function(e,t){k.uniformMatrix2fv(i.j[e],!1,t)},yf:function(e,t){k.uniformMatrix3fv(i.j[e],!1,t)},zf:function(e,t){k.uniformMatrix4fv(i.j[e],!1,t)},K:function(e,t){h.set(e),t.forEach((function(e){switch(e.type){case"4f":k.uniform4fv(i.j[e.name],e.value);break;case"3f":k.uniform3fv(i.j[e.name],e.value);break;case"2f":k.uniform2fv(i.j[e.name],e.value);break;case"1f":k.uniform1f(i.j[e.name],e.value);break;case"1i":k.uniform1i(i.j[e.name],e.value);break;case"mat2":k.uniformMatrix2fv(i.j[e.name],!1,e.value);break;case"mat3":k.uniformMatrix3fv(i.j[e.name],!1,e.value);break;case"mat4":k.uniformMatrix4fv(i.j[e.name],!1,e.value)}}))},Se:function(){return"lowp"},h:function(){for(var e in k.disableVertexAttribArray(0),h.ka(),E){var t=E[e];t.hb&&(t.hb=!1,k.deleteProgram(t.ua)),t.sd&&delete E[e]}r.forEach((function(e){k.deleteShader(e)})),r.splice(0),n=0,o=!1}};return h}(),k=null,j=function(){function e(e){return console.log("ERROR in ContextFeedForward: ",e),!1}var t=null,r=null,a=null,i=null,n=!0,o=null,u=null,l={A:function(){return t.width},N:function(){return t.height},Je:function(){return t},Ie:function(){return k},u:function(){return n},flush:function(){k.flush()},jd:function(){return o||(o=new Uint8Array(t.width*t.height*4)),k.readPixels(0,0,t.width,t.height,k.RGBA,k.UNSIGNED_BYTE,o),o},Le:function(){return t.toDataURL("image/jpeg")},Me:function(){Q.G(),r||(r=document.createElement("canvas"),a=r.getContext("2d")),r.width=t.width,r.height=t.height;for(var e=l.jd(),i=a.createImageData(r.width,r.height),n=r.width,o=r.height,u=i.data,s=0;s<o;++s)for(var c=o-s-1,d=0;d<n;++d){var f=4*(s*n+d),v=4*(c*n+d);u[f]=e[v],u[f+1]=e[v+1],u[f+2]=e[v+2],u[f+3]=e[v+3]}return a.putImageData(i,0,0),r.toDataURL("image/png")},Ke:function(e){!r&&e&&(r=document.createElement("canvas"),a=r.getContext("2d"));var i=e?r:document.createElement("canvas");return i.width=t.width,i.height=t.height,(e?a:i.getContext("2d")).drawImage(t,0,0),i},o:function(r){if(r.Vc&&!r.Ua?t=document.getElementById(r.Vc):r.Ua&&(t=r.Ua),t||(t=document.createElement("canvas")),t.width=r&&void 0!==r.width?r.width:512,t.height=r&&void 0!==r.height?r.height:512,void 0===r&&(r={}),void 0===r.premultipliedAlpha&&(r.premultipliedAlpha=!1),void 0===r.$b&&(r.$b=!0),void 0===r.antialias&&(r.antialias=!1),!k){var a={antialias:r.antialias,alpha:!0,preserveDrawingBuffer:!0,premultipliedAlpha:r.premultipliedAlpha,stencil:!1,depth:r.$b};navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("noAntialiasing")&&(a.antialias=!1),function(){return!!(navigator.userAgent&&-1!==navigator.userAgent.indexOf("forceWebGL1")||/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream)||!(!/(Mac)/i.test(navigator.platform)||(e=!!(e=navigator.userAgent)&&(!(!(e=e.match(/Mac OS X (\d+)_(\d+)/)||e.match(/Mac OS X (\d+).(\d+)/))||3>e.length)&&[parseInt(e[1],10),parseInt(e[2],10)]),!e||10!==e[0]||15!==e[1]));var e}()||(k=t.getContext("webgl2",a)),k?n=!0:((k=t.getContext("webgl",a))||(k=t.getContext("experimental-webgl",a)),n=!1)}return k?((i=k.getExtension("WEBGL_lose_context"))&&r.lc&&(u=r.lc,t.addEventListener("webglcontextlost",u,!1)),Z.o()?!Z.Kc()&&n?e("Your configuration cannot process color buffer float"):(k.clearColor(0,0,0,0),k.disable(k.DEPTH_TEST),k.disable(k.BLEND),k.disable(k.DITHER),k.disable(k.STENCIL_TEST),k.disable(k.SCISSOR_TEST),k.GENERATE_MIPMAP_HINT&&k.hint(k.GENERATE_MIPMAP_HINT,k.FASTEST),k.disable(k.SAMPLE_ALPHA_TO_COVERAGE),k.disable(k.SAMPLE_COVERAGE),!0):e("Not enough capabilities")):e("WebGL is not enabled")},qd:function(){return!!X.o()&&(k.depthFunc(k.LEQUAL),k.clearDepth(1),!0)},h:function(){k&&Z.h(),i&&u&&(t.removeEventListener("webglcontextlost",u,!1),u=null),o=a=r=t=null}};return l}(),Y=(P=void 0===X?null:X,{Od:function(e){P!==e&&(P&&P.ka(),P=e)},lb:function(){return P.lb()},xa:function(){P.xa()},wb:function(){P.wb()},ka:function(){P.ka()},set:function(e){P.set(e)},h:function(){P.h&&P.h()}}),W=function(){var e=null,t=null,r=0,a=-2,i=-2,n=!1,o=[],u={reset:function(){i=a=-2},o:function(){n||(e=k.createBuffer(),k.bindBuffer(k.ARRAY_BUFFER,e),k.bufferData(k.ARRAY_BUFFER,new Float32Array([-1,-1,3,-1,-1,3]),k.STATIC_DRAW),t=k.createBuffer(),k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,t),k.bufferData(k.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2]),k.STATIC_DRAW),u.oa(),n=!0)},instance:function(e){var t=r++,n=e.aa?e.aa.length:0,u=void 0===e.mode?k.STATIC_DRAW:e.mode,l=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,l),k.bufferData(k.ARRAY_BUFFER,e.wc instanceof Float32Array?e.wc:new Float32Array(e.wc),u),a=t;var s=null,c=null,d=null;if(e.aa){s=k.createBuffer(),k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,s);var f=null;65536>e.aa.length?(f=Uint16Array,c=k.UNSIGNED_SHORT,d=2):(f=Uint32Array,c=k.UNSIGNED_INT,d=4),k.bufferData(k.ELEMENT_ARRAY_BUFFER,e.aa instanceof f?e.aa:new f(e.aa),u),i=t}var v={Jc:function(e){a!==t&&(k.bindBuffer(k.ARRAY_BUFFER,l),a=t),e&&Y.wb()},Gc:function(){i!==t&&(k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,s),i=t)},bind:function(e){v.Jc(e),v.Gc()},qe:function(){k.drawElements(k.TRIANGLES,n,c,0)},re:function(e,t){k.drawElements(k.TRIANGLES,e,c,t*d)},remove:function(){k.deleteBuffer(l),e.aa&&k.deleteBuffer(s),v=null}};return o.push(v),v},oa:function(){-1!==a&&(k.bindBuffer(k.ARRAY_BUFFER,e),a=-1),-1!==i&&(k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,t),i=-1)},g:function(e,t){e&&W.oa(),t&&Y.xa(),k.drawElements(k.TRIANGLES,3,k.UNSIGNED_SHORT,0)},Rb:function(){k.deleteBuffer(e),k.deleteBuffer(t)},h:function(){u.Rb(),o.forEach((function(e){e.remove()})),k.bindBuffer(k.ARRAY_BUFFER,null),k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,null),u.reset(),n=!1,o.splice(0),r=0}};return u}(),V=function(){var e=null,t=null,r=null,a=!1,i=[],n={w:-2,Pb:1},o={o:function(){if(!a){e=k.createFramebuffer();var i=Z.u();t=i&&k.DRAW_FRAMEBUFFER?k.DRAW_FRAMEBUFFER:k.FRAMEBUFFER,r=i&&k.READ_FRAMEBUFFER?k.READ_FRAMEBUFFER:k.FRAMEBUFFER,a=!0}},Oe:function(){return t},cb:function(){return r},ha:function(){return k.FRAMEBUFFER},Ve:function(){return n},He:function(){return e},instance:function(r){void 0===r.Zb&&(r.Zb=!1);var a=r.W?r.W:null,o=r.width,u=void 0!==r.height?r.height:r.width,l=e,s=null,c=!1,d=!1,f=0;a&&(o=o||a.A(),u=u||a.N());var v={qc:function(){c||(l=k.createFramebuffer(),c=!0,f=n.Pb++)},zc:function(){v.qc(),v.l(),s=k.createRenderbuffer(),k.bindRenderbuffer(k.RENDERBUFFER,s),k.renderbufferStorage(k.RENDERBUFFER,k.DEPTH_COMPONENT16,o,u),k.framebufferRenderbuffer(t,k.DEPTH_ATTACHMENT,k.RENDERBUFFER,s),k.clearDepth(1)},bind:function(e,r){f!==n.w&&(k.bindFramebuffer(t,l),n.w=f),a&&a.l(),r&&k.viewport(0,0,o,u),e&&k.clear(k.COLOR_BUFFER_BIT|k.DEPTH_BUFFER_BIT)},ce:function(){f!==n.w&&(k.bindFramebuffer(t,l),n.w=f)},clear:function(){k.clear(k.COLOR_BUFFER_BIT|k.DEPTH_BUFFER_BIT)},je:function(){k.clear(k.COLOR_BUFFER_BIT)},ke:function(){k.clear(k.DEPTH_BUFFER_BIT)},Qd:function(){k.viewport(0,0,o,u)},l:function(){f!==n.w&&(k.bindFramebuffer(t,l),n.w=f)},rtt:function(e){a=e,n.w!==f&&(k.bindFramebuffer(k.FRAMEBUFFER,l),n.w=f),e.l()},G:function(){k.bindFramebuffer(t,null),n.w=-1},resize:function(e,t){o=e,u=t,s&&(k.bindRenderbuffer(k.RENDERBUFFER,s),k.renderbufferStorage(k.RENDERBUFFER,k.DEPTH_COMPONENT16,o,u))},remove:function(){l===e||d||(k.bindFramebuffer(t,l),k.framebufferTexture2D(t,k.COLOR_ATTACHMENT0,k.TEXTURE_2D,null,0),s&&k.framebufferRenderbuffer(t,k.DEPTH_ATTACHMENT,k.RENDERBUFFER,null),k.bindFramebuffer(t,null),k.deleteFramebuffer(l),s&&k.deleteRenderbuffer(s)),d=!0}};return r.Zb&&v.zc(),i.push(v),v},G:function(){k.bindFramebuffer(t,null),n.w=-1},Wd:function(){k.bindFramebuffer(t,null),k.clear(k.COLOR_BUFFER_BIT|k.DEPTH_BUFFER_BIT),k.viewport(0,0,Z.A(),Z.N()),n.w=-1},reset:function(){n.w=-2},U:function(){0!==n.w&&(k.bindFramebuffer(t,e),n.w=0)},clear:function(){k.viewport(0,0,Z.A(),Z.N()),k.clear(k.COLOR_BUFFER_BIT)},h:function(){o.G(),i.forEach((function(e){e.remove()})),k.deleteFramebuffer(e),o.reset(),a=!1,i.splice(0),n.w=-2,n.Pb=1}};return o}(),J=function(){function e(e){k.bindTexture(k.TEXTURE_2D,e)}function t(e){var t=new Uint16Array(e.length);return e.forEach((function(e,r){t[r]=function(e){R[0]=e;var t=(e=F[0])>>16&32768,r=e>>12&2047,a=e>>23&255;return 103>a?t:142<a?31744|t|((255==a?0:1)&&8388607&e):113>a?t|((r|=2048)>>114-a)+(r>>113-a&1):t=(t|a-112<<10|r>>1)+(1&r)}(e)})),t}function r(e){if(!Y.lb()||!f)return null;var t=null;try{if(k.getError(),t=A.instance({isFloat:!1,H:!0,array:e,width:1}),k.getError()!==k.NO_ERROR)return!1}catch(e){return!1}return V.G(),k.viewport(0,0,1,1),k.clearColor(0,0,0,0),k.clear(k.COLOR_BUFFER_BIT),Y.set("s0"),t.Db(0),W.g(!1,!0),e=new Uint8Array(4),k.readPixels(0,0,1,1,k.RGBA,k.UNSIGNED_BYTE,e),e=.9<e[0],t.remove(),V.U(),e}var a=0,i=null,n=0,o=null,u=null,l=null,s=null,c=null,d=null,f=!1,v=[],E={isFloat:!1,isPot:!0,isLinear:!1,isMipmap:!1,isAnisotropicFiltering:!1,isMirrorX:!1,isMirrorY:!1,isSrgb:!1,isKeepArray:!1,isFlipY:null,width:0,height:0,url:null,array:null,data:null,D:null,rd:!1,H:!1,Z:null,Ka:4,mb:0},h=!1,g=null,p=null,x=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],T=!1,b=!1,R=new Float32Array(1),F=new Int32Array(R.buffer),_={fb:null,gb:null},A={o:function(){if(!f){if(c=[k.RGB,!1,k.RGB,k.RGBA],d=[k.RGB,!1,k.RGB,k.RGBA],i=[k.TEXTURE0,k.TEXTURE1,k.TEXTURE2,k.TEXTURE3,k.TEXTURE4,k.TEXTURE5,k.TEXTURE6,k.TEXTURE7],T="undefined"!=typeof JEContext,b=void 0!==Z,T&&JEContext.gf()&&i.push(k.TEXTURE8,k.TEXTURE9),o=[-1,-1,-1,-1,-1,-1,-1,-1],s=[k.UNSIGNED_BYTE,k.FLOAT,k.FLOAT],!u){for(var e=new Float32Array(16384),t=0;16384>t;++t)e[t]=2*Math.random()-1;u={random:A.instance({isFloat:!0,isPot:!0,array:e,width:64}),vc:A.instance({isFloat:!1,isPot:!0,width:1,array:new Uint8Array([0,0,0,0])})}}f=!0}},pd:function(){A.Yd()},Ze:function(){return u.vc},Yd:function(){s[1]=Z.Fa()},Kd:function(){d=c=[k.RGBA,k.RGBA,k.RGBA,k.RGBA]},lf:function(e,t){X.set("s1"),V.G();var r=e.A(),a=e.N();k.viewport(0,0,r,a),e.b(0),W.g(!1,!1),k.readPixels(0,0,r,a,k.RGBA,k.UNSIGNED_BYTE,t)},ed:function(t,r,i){k.activeTexture(k.TEXTURE0),a=0;var n=k.createTexture();e(n);var o=Z.u()&&k.RGBA32F?k.RGBA32F:k.FLOAT;r=r instanceof Float32Array?r:new Float32Array(r);var u=N.wd(r.length);u!==Math.floor(u)&&(k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE)),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST),k.pixelStorei(k.UNPACK_FLIP_Y_WEBGL,i),k.texImage2D(k.TEXTURE_2D,0,k.RGBA,t.A(),t.N(),0,k.RGBA,o,r),e(null),k.pixelStorei(k.UNPACK_FLIP_Y_WEBGL,!1),V.U(),X.set("s0"),t.J(),k.clearColor(0,0,0,0),k.clear(k.COLOR_BUFFER_BIT),e(n),W.g(!0,!1),k.deleteTexture(n)},instance:function(u){function f(){if(e(I),Q&&k.pixelStorei(k.UNPACK_FLIP_Y_WEBGL,Q),R.isPot?(k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,R.isMirrorX?k.MIRRORED_REPEAT:k.REPEAT),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,R.isMirrorY?k.MIRRORED_REPEAT:k.REPEAT)):(k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE)),R.isAnisotropicFiltering&&"undefined"!=typeof JESETTINGS&&k.texParameterf(k.TEXTURE_2D,JEContext.Ne().TEXTURE_MAX_ANISOTROPY_EXT,JESETTINGS.ae),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,R.isLinear?k.LINEAR:k.NEAREST),R.isLinear?k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,R.isMipmap&&!$?k.NEAREST_MIPMAP_LINEAR:k.LINEAR):k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,R.isMipmap&&!$?k.NEAREST_MIPMAP_NEAREST:k.NEAREST),K=c[R.Ka-1],J=d[R.Ka-1],q=s[w],Z.u()){var t=k.RGBA32F;K===k.RGBA&&q===k.FLOAT&&t&&(J=t),K===k.RGB&&q===k.FLOAT&&t&&(J=t,K=k.RGBA)}if((R.H&&!R.isFloat||R.isFloat&&R.isMipmap&&ee.vd())&&((t=k.RGBA16F)&&(J=t),q=Z.Fa()),R.mb&&(re=R.mb),R.isSrgb&&4===R.Ka&&(K=JEContext.Xe()),R.D)k.texImage2D(k.TEXTURE_2D,0,J,K,q,R.D);else if(R.url)k.texImage2D(k.TEXTURE_2D,0,J,K,q,C);else if(L){try{k.getError(),k.texImage2D(k.TEXTURE_2D,0,J,U,B,0,K,q,L),k.getError()!==k.NO_ERROR&&(k.texImage2D(k.TEXTURE_2D,0,J,U,B,0,K,q,null),k.getError()!==k.NO_ERROR&&k.texImage2D(k.TEXTURE_2D,0,k.RGBA,U,B,0,k.RGBA,k.UNSIGNED_BYTE,null))}catch(e){k.texImage2D(k.TEXTURE_2D,0,J,U,B,0,K,q,null)}R.isKeepArray||(L=null)}else k.texImage2D(k.TEXTURE_2D,0,J,U,B,0,K,q,null);if(R.isMipmap)if(!$&&ne)ne.bb(),ae=!0;else if($){t=Math.log(Math.min(U,B))/Math.log(2),(te=Array(1+t))[0]=I;for(var r=1;r<=t;++r){var i=Math.pow(2,r),n=U/i;i=B/i;var u=k.createTexture();e(u),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST),k.texImage2D(k.TEXTURE_2D,0,J,n,i,0,K,q,null),e(null),te[r]=u}ae=!0}e(null),o[a]=-1,Q&&k.pixelStorei(k.UNPACK_FLIP_Y_WEBGL,!1),P=!0,R.Z&&ne&&(R.Z(ne),R.Z=null)}var R=Object.assign({},E,u),F=n++;null===R.isFlipY&&(R.isFlipY=!(!R.url&&!R.array)),R.data&&(R.array="string"==typeof R.data?function(e){var t=JSON.parse(e);e=t.ne;var r=t.nf,a=t.n,i="undefined"==typeof btoa?Buffer.from(t.data,"base64").toString("latin1"):atob(t.data),n=i.length;t=new Uint8Array(n);for(var o=0;o<n;++o)t[o]=i.charCodeAt(o);i=new Float32Array(a),n=new Float32Array(r),o=e+r+1;for(var u=0;u<a;++u){for(var l=o*u,s=0===m(t,l)?1:-1,c=l+1,d=1,f=0,v=c+e-1;v>=c;--v)f+=d*m(t,v),d*=2;for(c=f,l=l+1+e,d=n.length,f=0,v=l;v<l+d;++v)n[f]=m(t,v),++f;for(d=l=0;d<r;++d)l+=n[d]*Math.pow(2,-d-1);i[u]=0===l&&0===c?0:s*(1+l)*Math.pow(2,1+c-Math.pow(2,e-1))}return i}(R.data):R.isFloat?new Float32Array(R.data):new Uint8Array(R.data),R.isFlipY=!1);var w=0,y=!!R.D,S=null,D=null,M=!1,O=null;R.H=R.H||R.isFloat,R.H&&(w=1),R.rd||Z.u()||!R.isFloat||!b||Z.Fb()||(R.isFloat=!1),R.isFloat&&(w=2),R.isAnisotropicFiltering&&T&&!JEContext.af()&&(R.isAnisotropicFiltering=!1);var I=k.createTexture(),C=null,L=!1,U=0,B=0,P=!1,N=!1,H=null,G=null,z=null,j=null,J=null,K=null,q=null,Q=R.isFlipY,$=!(!R.H||!R.isMipmap||void 0===ee||ee.Mc()),te=null,re=-1,ae=!1,ie={bc:!1,Eb:null,Qb:null};R.width&&(U=R.width,B=R.height?R.height:U);var ne={get:function(){return I},A:function(){return U},N:function(){return B},$e:function(){return R.url},bf:function(){return R.isFloat},df:function(){return R.H},ef:function(){return R.isLinear},bb:function(){k.generateMipmap(k.TEXTURE_2D)},Ic:function(t,r){$?(t||(t=ne.Ub()),ne.Sa(r),e(te[t]),o[r]=-1):ne.b(r)},Ub:function(){return-1===re&&(re=Math.log(U)/Math.log(2)),re},fd:function(t){if($){t||(t=ne.Ub()),X.set("s11"),ne.Sa(0);for(var r=U,a=B,i=1;i<=t;++i)r/=2,a/=2,X.wa("u7",.25/r,.25/a),k.viewport(0,0,r,a),e(te[i-1]),k.framebufferTexture2D(V.ha(),k.COLOR_ATTACHMENT0,k.TEXTURE_2D,te[i],0),W.g(!1,1===i);o[0]=-1}else ne.bb()},Sa:function(e){e!==a&&(k.activeTexture(i[e]),a=e)},b:function(t){return!!P&&(ne.Sa(t),o[t]!==F&&(e(I),o[t]=F,!0))},Db:function(t){k.activeTexture(i[t]),a=t,e(I),o[t]=F},l:function(){l=ne,k.framebufferTexture2D(V.ha(),k.COLOR_ATTACHMENT0,k.TEXTURE_2D,I,0)},J:function(){l=ne,k.viewport(0,0,U,B),k.framebufferTexture2D(V.ha(),k.COLOR_ATTACHMENT0,k.TEXTURE_2D,I,0)},xb:A.xb,resize:function(e,t){U=e,B=t,f()},clone:function(e){return e=A.instance({width:U,height:B,H:R.H,isFloat:R.isFloat,isLinear:R.isLinear,isMirrorY:R.isMirrorY,isFlipY:e?!Q:Q,isPot:R.isPot}),Y.set("s0"),V.U(),e.l(),k.viewport(0,0,U,B),ne.b(0),W.g(!0,!0),e},Qd:function(){k.viewport(0,0,U,B)},remove:function(){k.deleteTexture(I),v.splice(v.indexOf(ne),1),ne=null},refresh:function(){ne.Db(0),Q&&k.pixelStorei(k.UNPACK_FLIP_Y_WEBGL,!0),y?k.texImage2D(k.TEXTURE_2D,0,J,K,k.UNSIGNED_BYTE,R.D):k.texImage2D(k.TEXTURE_2D,0,J,U,B,0,K,q,L),Q&&k.pixelStorei(k.UNPACK_FLIP_Y_WEBGL,!1)},Jb:function(){var e=U*B*4;G=[new Uint8Array(e),new Uint8Array(e),new Uint8Array(e),new Uint8Array(e)],H=[new Float32Array(G[0].buffer),new Float32Array(G[1].buffer),new Float32Array(G[2].buffer),new Float32Array(G[3].buffer)],z=new Uint8Array(4*e),j=new Float32Array(z.buffer),N=!0},pc:function(){N||ne.Jb(),k.readPixels(0,0,U,4*B,k.RGBA,k.UNSIGNED_BYTE,z);for(var e=U*B,t=2*e,r=3*e,a=0;a<e;++a)H[0][a]=j[a],H[1][a]=j[a+e],H[2][a]=j[a+t],H[3][a]=j[a+r];return H},Gd:function(){return ie.bc||(ie.Eb=new Uint8Array(U*B*4),ie.Qb=new Float32Array(ie.buffer),ie.bc=!0),k.readPixels(0,0,U,B,k.RGBA,k.UNSIGNED_BYTE,ie.Eb),ie.Qb},Kb:function(e){if(V.G(),X.set("s12"),ne.b(0),e)k.viewport(0,0,U,B),X.vb("u8",.25,.25,.25,.25),W.g(!1,!0);else for(e=0;4>e;++e)k.viewport(0,B*e,U,B),X.vb("u8",x[e]),W.g(!1,0===e)},Xd:function(t){var i=q===s[0]&&!function(){if(null!==_.gb)return _.gb;var e=r(new Uint8Array([255,255,255,255]));return null===e||(_.gb=e)}();e(I),Q&&k.pixelStorei(k.UNPACK_FLIP_Y_WEBGL,!0),i?(M||((S=document.createElement("canvas")).width=U,S.height=B,D=S.getContext("2d"),O=D.createImageData(U,B),M=!0),O.data.set(t),D.putImageData(O,0,0),k.texImage2D(k.TEXTURE_2D,0,J,K,q,S)):k.texImage2D(k.TEXTURE_2D,0,J,U,B,0,K,q,t),o[a]=F,Q&&k.pixelStorei(k.UNPACK_FLIP_Y_WEBGL,!1)},Cf:function(t,r){e(I),r&&k.pixelStorei(k.UNPACK_FLIP_Y_WEBGL,!0),k.texImage2D(k.TEXTURE_2D,0,J,K,q,t),o[a]=F,r&&k.pixelStorei(k.UNPACK_FLIP_Y_WEBGL,!1)},sf:function(e,t){var r=U*B,a=4*r;e=R.H?e?"RGBE":"JSON":"RGBA",t&&(e=t),t=Z.u()&&!1;var i=null;switch(e){case"RGBE":i="s40";break;case"JSON":i=t?"s0":"s12";break;case"RGBA":case"RGBAARRAY":i="s6"}if(N||("RGBA"===e||"RGBE"===e||"RGBAARRAY"===e?(G=new Uint8Array(a),N=!0):"JSON"!==e||t||ne.Jb()),V.G(),X.set(i),ne.b(0),a=null,"RGBA"===e||"RGBE"===e||"RGBAARRAY"===e){if(k.viewport(0,0,U,B),W.g(!0,!0),k.readPixels(0,0,U,B,k.RGBA,k.UNSIGNED_BYTE,G),"RGBAARRAY"===e)return{data:G};h||(g=document.createElement("canvas"),p=g.getContext("2d"),h=!0),g.width=U,g.height=B,(r=p.createImageData(U,B)).data.set(G),p.putImageData(r,0,0),a=g.toDataURL("image/png")}else if("JSON"===e)if(t)a=new Float32Array(r),k.viewport(0,0,U,B),W.g(!0,!0),k.readPixels(0,0,U,B,k.RGBA,k.FLOAT,a);else{for(a=0;4>a;++a)k.viewport(0,B*a,U,B),X.vb("u8",x[a]),W.g(!a,!a);for(ne.pc(),a=Array(r),t=0;t<r;++t)a[4*t]=H[0][t],a[4*t+1]=H[1][t],a[4*t+2]=H[2][t],a[4*t+3]=H[3][t]}return{format:e,data:a,width:U,height:B,isMirrorY:R.isMirrorY,isFlipY:"RGBA"===e?R.isFlipY:!R.isFlipY}}};return R.isMipmap&&!$&&P&&!ae&&(ne.bb(),ae=!0),R.url?(e(I),k.texImage2D(k.TEXTURE_2D,0,k.RGBA,1,1,0,k.RGBA,k.UNSIGNED_BYTE,null),(C=new Image).oe="Anonymous",C.crossOrigin="Anonymous",C.src=R.url,C.onload=function(){U=C.width,B=C.height,f()}):R.D?function e(){U=void 0!==R.D.videoWidth?R.D.videoWidth:R.D.width,B=void 0!==R.D.videoHeight?R.D.videoHeight:R.D.height,U?f():setTimeout(e,1)}():R.array?(R.H&&!R.isFloat?R.array instanceof Uint16Array?(L=R.array,f()):function(){if(null!==_.fb)return _.fb;var e=r(t([1,1,1,1]));return null===e||(_.fb=e)}()?(L=t(R.array),f()):(f(),A.ed(ne,R.array,Q)):(L=R.isFloat?R.array instanceof Float32Array?R.array:new Float32Array(R.array):R.array instanceof Uint8Array?R.array:new Uint8Array(R.array),f()),R.isKeepArray||(L&&L!==R.array&&(L=null),delete R.array)):f(),ne.We=ne.A,R.Z&&P&&(R.Z(ne),R.Z=null),v.push(ne),ne},G:function(t){t!==a&&(k.activeTexture(i[t]),a=t),o[t]=-1,e(null)},ee:function(e){u.random.b(e)},xb:function(){l=null,k.framebufferTexture2D(V.ha(),k.COLOR_ATTACHMENT0,k.TEXTURE_2D,null,0)},reset:function(){for(var e=0;e<i.length;++e)o[e]=-1;a=-1},qf:function(){a=-1},Vd:function(){for(var e=0;e<i.length;++e)A.G(e)},Rb:function(){u&&(u.random.remove(),u.vc.remove())},Bf:function(e,t){if("RGBA"===e.format||"RGBE"===e.format){var r=new Image;r.src=e.data,r.onload=function(){A.instance({isMirrorY:e.isMirrorY,isFlipY:e.isFlipY,isFloat:!1,D:r,Z:function(r){if("RGBA"===e.format)t(r);else{var a=e.width,i=e.height,n=A.instance({isMirrorY:e.isMirrorY,isFloat:!0,width:a,height:i,isFlipY:e.isFlipY});V.U(),k.viewport(0,0,a,i),X.set("s41"),n.l(),r.b(0),W.g(!0,!0),A.G(0),t(n),k.flush(),setTimeout(r.remove,50)}}})}}else"JSON"===e.format?t(A.instance({isFloat:!0,isFlipY:e.isFlipY,width:e.width,height:e.height,array:new Float32Array(e.data)})):t(!1)},h:function(){l&&(Q.U(),A.xb(),Q.G()),A.Vd(),v.slice(0).forEach((function(e){e.remove()})),v.splice(0),f=!1,n=0,ee.h()}};return A}(),K={instance:function(e){var t=[J.instance(e),J.instance(e)],r=[t[1],t[0]],a=r,i={Nd:function(e){a[1].l(),a[0].b(e),i.sc()},tf:function(e){a[1].J(),a[0].b(e),i.sc()},sc:function(){a=a===t?r:t},refresh:function(){a[0].refresh(),a[1].refresh()},b:function(e){a[0].b(e)},de:function(e){a[1].b(e)},Qe:function(){return a[0]},remove:function(){a[0].remove(),a[1].remove(),a=null}};return i}},Z=function(){function e(){t=void 0===j?JEContext:j,r=!0}var t=null,r=!1,a=!1,i=null,n=null,o=!1,u=null,l=!1,s=null,c=!1,d=null,f=!1,v=!0,E=!0,m=!0,h=null,g="undefined"==typeof window?{}:window,p={o:function(){return!!r||(e(),p.Nb(),p.ab(),p.ad(),p.bd(),V.o(),J.o(),!!p.Wc()&&(W.o(),J.pd(),!0))},A:function(){return r||e(),t.A()},N:function(){return r||e(),t.N()},u:function(){return r||e(),t.u()},ad:function(){f=!!(d=k.getExtension("EXT_color_buffer_float")||k.getExtension("WEBGL_color_buffer_float")||k.getExtension("OES_color_buffer_float")),g.GL_EXT_COLORBUFFERFLOAT=d},bd:function(){k.getExtension("EXT_color_buffer_half_float")||k.getExtension("WEBGL_color_buffer_half_float")||k.getExtension("OES_color_buffer_half_float")},Nb:function(){a||(this.u()||(i=k.getExtension("OES_texture_float")||k.getExtension("MOZ_OES_texture_float")||k.getExtension("WEBKIT_OES_texture_float"),o=!!(g.GL_EXT_FLOAT=i)),(o||this.u())&&(n=k.getExtension("OES_texture_float_linear")||k.getExtension("MOZ_OES_texture_float_linear")||k.getExtension("WEBKIT_OES_texture_float_linear"),g.GL_EXT_FLOATLINEAR=n),a=!0)},ab:function(){c||(this.u()||((u=k.getExtension("OES_texture_half_float")||k.getExtension("MOZ_OES_texture_half_float")||k.getExtension("WEBKIT_OES_texture_half_float"))&&(h=u.HALF_FLOAT_OES,l=!0),!h&&k.HALF_FLOAT&&(h=k.HALF_FLOAT),!h&&k.FLOAT&&(h=k.FLOAT),g.GL_EXT_HALFFLOAT=u),(l||this.u())&&(s=k.getExtension("OES_texture_half_float_linear")||k.getExtension("MOZ_OES_texture_half_float_linear")||k.getExtension("WEBKIT_OES_texture_half_float_linear"),g.GL_EXT_HALFFLOATLINEAR=s),c=!0)},Fa:function(){return p.u()?k.HALF_FLOAT:(p.ab(),l?h:k.FLOAT)},Fb:function(){return v},Lc:function(){return E},fe:function(){return m},Kc:function(){return f},Yc:function(){E=v=!0;var e=k.createFramebuffer();k.bindFramebuffer(k.FRAMEBUFFER,e);var t=k.createTexture();k.bindTexture(k.TEXTURE_2D,t),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST),k.texImage2D(k.TEXTURE_2D,0,p.u()&&k.RGBA32F?k.RGBA32F:k.RGBA,1,1,0,k.RGBA,k.FLOAT,null),k.framebufferTexture2D(V.ha(),k.COLOR_ATTACHMENT0,k.TEXTURE_2D,t,0);var r=k.checkFramebufferStatus(V.cb());r!==k.FRAMEBUFFER_COMPLETE&&(v=!1),k.texImage2D(k.TEXTURE_2D,0,p.u()&&k.RGBA16F?k.RGBA16F:k.RGBA,1,1,0,k.RGBA,p.Fa(),null),k.framebufferTexture2D(V.ha(),k.COLOR_ATTACHMENT0,k.TEXTURE_2D,t,0),(r=k.checkFramebufferStatus(V.cb()))!==k.FRAMEBUFFER_COMPLETE&&(E=!1),k.bindTexture(k.TEXTURE_2D,null),k.bindFramebuffer(k.FRAMEBUFFER,null),k.deleteTexture(t),k.deleteFramebuffer(e)},Xc:function(){var e=V.instance({width:1});e.qc();var t=J.instance({width:1,isFloat:!0,Ka:3});e.l(),t.l(),k.flush(),k.checkFramebufferStatus(V.cb())!==k.FRAMEBUFFER_COMPLETE?(J.Kd(),m=!1):m=!0,e.remove(),t.remove()},Wc:function(){return p.Yc(),!(!v&&!E||(p.Xc(),0))},h:function(){J.h(),Y.h(),V.h(),W.h(),r=!1}};return p}(),q=W,Q=V,$=J,ee=function(){function e(e,t,r,a){k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,a?k.NEAREST_MIPMAP_NEAREST:k.LINEAR);var i=null;try{if((i=k.getError())!==k.NO_ERROR&&console.log("GLERR in test_mipmapping():",i),k.texImage2D(k.TEXTURE_2D,0,e,2,2,0,k.RGBA,t,r),(i=k.getError())!==k.NO_ERROR)return!1}catch(e){return!1}return a&&k.generateMipmap(k.TEXTURE_2D),q.oa(),q.g(!1,!0),k.readPixels(0,0,1,1,k.RGBA,k.UNSIGNED_BYTE,o),(i=k.getError())===k.INVALID_OPERATION&&void 0!==k.PIXEL_PACK_BUFFER&&(k.bindBuffer(k.PIXEL_PACK_BUFFER,null),k.readPixels(0,0,1,1,k.RGBA,k.UNSIGNED_BYTE,o),i=k.getError()),i===k.NO_ERROR&&0!==o[0]}function t(t){return!(!Z.Fb()||!e(c,k.FLOAT,new Float32Array(l),t)||(n=i.Ab,0))}function r(t){return!(!Z.Lc()||!e(d,Z.Fa(),new Uint16Array(l),t)&&!e(d,k.FLOAT,new Float32Array(l),t)||(n=i.Ra,0))}var a=!1,i={Ab:3,Ra:2,RGBA8:0},n=i.RGBA8,o=new Uint8Array(4),u=[.8,1,.8,1],l=u.concat(u,u,u),s=!0,c=null,d=null,f={o:function(){if(Z.Nb(),Z.ab(),d=c=k.RGBA,j.u()){var e=k.RGBA32F;e&&(c=e),(e=k.RGBA16F)&&(d=e)}if(q.o(),Q.reset(),Q.G(),k.viewport(0,0,1,1),X.set("s0"),a=!0,e=k.createTexture(),k.activeTexture(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,e),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.REPEAT),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.REPEAT),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST),r(!0)||t(!0))return!0;if(s=!1,r(!1)||t(!1))return!0;if(j.u()){if(d=c=k.RGBA,r(!0)||t(!0))return!0;if(s=!1,r(!1)||t(!1))return!0}return!1},Mc:function(){return s},Re:function(){return n},cf:function(){return a||f.o(),n===i.Ab},vd:function(){return a||f.o(),n===i.Ra},h:function(){a=!1,n=i.RGBA8,s=!0}};return f}(),te={instance:function(e){var t=$.instance(e.alpha),r=$.instance(e.beta);return{$c:function(){t.b(1),r.b(2)}}}},re={instance:function(e){var t=null,r=!1,a=!1,i=null,n=!1,o=!1,u=null,l=void 0!==e.preprocessing&&e.preprocessing,s=void 0===e.preprocessingSize?e.size:e.preprocessingSize;e.mask&&(r=!0,de&&void 0!==de.Fc&&(e.mask=de.Fc+e.mask),t=$.instance({isFloat:!1,url:e.mask}));var c=!1;switch(e.customInputShader&&(c="s42",X.Bb({name:"_",id:c,a:e.customInputShader,c:["uSource"],precision:"lowp"}),X.K(c,[{type:"1i",name:"_",value:0}])),l){case"sobel":u="s31",n=!0;break;case"meanNormalization":u="s32",n=!0;break;case"grayScale":u="s28",n=!1;break;case"grayScaleTilt":u="s29",o=!0,n=!1;break;case"rgbGrayTilt":u="s30",o=!0,n=!1;break;case"copy":u=c||"s0";break;case"inputLightRegulation":u=c||"s28",i=se.instance({Yb:s,nc:e.size,fc:e.nBlurPass,ud:!1}),a=!0;break;case"direct":case"none":u=!1;break;default:u="s3"}o&&X.K(u,[{name:"u26",type:"1f",value:e.tilt}]),r&&(u+="Mask");var d=$.instance({isFloat:!1,isPot:!1,width:e.size}),f={A:function(){return s},eb:function(){return f.A()},ld:function(){return a?i.Vb():d},I:function(){Q.U(),u&&(X.set(u),n&&X.B("u27",1/e.size),d.J(),r&&t.b(1),q.g(!1,!1),d.b(0),a&&i.process(d))},h:function(){d.remove(),r&&t.remove()}};return f}},ae={instance:function(e){void 0===e.disableNormalize&&(e.disableNormalize=!1);var t={input:null,fa:null,ib:null,S:null,Ma:null,rb:null,sb:null},r=null,a=[],i=[],n=!1,o=null,u=!0,l=-1,s=!!e.isReorganize&&e.isReorganize,c=!!e.kernelsNumber,d=!!e.dynPelu&&te.instance(e.dynPelu),f=!!d,v={isEnabled:!1};e.td?(e.sparsity=void 0!==e.sparsity?e.sparsity:e.Na.eb(),u=!1):"full"===e.connectivityUp&&(e.sparsity=e.Na.eb());var E={elu:"s15",elu01:"s16",relu:"s14",arctan:"s18",sigmoid:"s13",copy:"s0",softplus:"s19",dynPelu:"s17"}[e.activation],m=e.sparsity*e.sparsity,h=!1,g=e.size,p="";if(e.maxPooling){switch(e.maxPooling.size){case 2:p="s33";break;case 4:p="s34"}h=!0,g/=e.maxPooling.size,t.rb=$.instance({isFloat:!0,isPot:!1,width:g})}var x=!(void 0===e.Cd||!e.Cd),T=null,b=null,R=null;if(x){T="s43"+e.index.toString(),X.Xb("s43",T,[((e.normalization.n-1)/2).toFixed(1)]),X.K(T,[{type:"1i",name:"u1",value:0},{type:"2f",name:"u7",value:[1/e.size,1/e.size]},{type:"1f",name:"u6",value:e.normalization.alpha},{type:"1f",name:"u9",value:e.normalization.beta},{type:"1f",name:"u31",value:e.normalization.k}]);var F={isFloat:!0,isPot:!0,width:e.size};b=$.instance(F),R=$.instance(F)}var _=-1,A=null;u&&(t.S=$.instance({isFloat:!0,isPot:!1,width:e.size})),t.fa=$.instance(e.bias);var w={A:function(){return e.size},eb:function(){return g},Sb:function(){return e.classesCount},Hc:function(e){r.b(e)},Ed:function(){e.remap&&e.remap.isEnabled&&(v={isEnabled:!0,yd:$.instance({isFloat:!1,isFlipY:!1,array:new Uint8Array(e.remap.maskTexture.data),width:e.remap.maskTexture.width,isPot:!1}),layers:e.remap.layers.map((function(t){return e.parent.kd(t)})),depth:e.remap.depth})},Md:function(){switch(e.connectivityUp){case"direct":A=ie.instance(e.connectivity);break;case"square":A=oe.instance(e.connectivity);break;case"squareFast":A=le.instance(e.connectivity,e.activation);break;case"full":A=ne.instance(e.connectivity);break;case"conv":l=e.kernelsNumber,A=ue.instance(e.connectivity),s&&(t.Ma=$.instance({width:g,isFloat:!0,isFlipY:!1,isPot:!1}))}if(A.ja){var r=e.size*e.sparsity;_=Math.log(r/e.size)/Math.log(2),t.input=$.instance({isMipmap:!0,isFloat:!0,isPot:!0,width:r,mb:_}),t.ib=$.instance({isFloat:!0,isPot:!0,width:e.size})}},I:function(a){if(r=a,A.ja?(t.input.J(),c&&t.fa.b(2),A.I(v),t.input.b(0),t.input.fd(_),t.ib.J(),c?X.set("s0"):(X.set("s27"),X.B("u25",m),t.fa.b(1)),t.input.Ic(_,0),q.g(!1,!1),X.set(E),x?b.l():t.S.l(),t.ib.b(0),f&&d.$c(),q.g(!1,!1)):(t.S.J(),t.fa.b(1),A.I()),x&&(X.set(T),R.l(),b.b(0),q.g(!1,!1),X.set("s44"),X.B("u6",1),t.S.l(),R.b(1),q.g(!1,!1)),u)return h?(t.rb.J(),t.S.b(0),X.set(p),X.wa("u7",1/e.size,1/e.size),q.g(!1,!1),a=t.rb):a=t.S,a.b(0),s&&(t.Ma.l(),X.set("s21"),X.wa("u12",l,g/l),q.g(!1,!1),a=t.Ma,t.Ma.b(0)),a;switch(a=t.S,e.disableNormalize||(X.set("gpuRawAvg"===n?"s8":"s7"),X.B("u4",1/e.size),t.sb.J(),t.S.b(0),q.g(!1,!1),a=t.sb),n){case"cpuRGBA2Float":a.Kb(!1),a=w.Fd(a),o(a);break;case"cpuMeanFloat":a.Kb(!0),a=a.Gd(),o(a);break;case"gpuRawAvg":case"gpuRaw":a.b(0);case"none":o(a)}return!1},Uc:function(r){r&&void 0!==r.mc&&(n=r.mc,o=r.Dd),t.S=$.instance({isFloat:!0,isPot:!0,isMipmap:!1,width:e.size}),r=void 0!==e.classesCount&&e.classesCount?e.classesCount:e.size*e.size;for(var u=0,l=0,s=0;u<r;++u)a.push(l+(e.size-1-s)*e.size),i.push([-1,-1,-1,-1]),++l===e.size&&(l=0,++s);e.disableNormalize||(t.sb=$.instance({isFloat:!0,isPot:!0,width:e.size}))},Fd:function(e){var t=e.pc();return a.forEach((function(e,r){i[r][0]=t[0][e],i[r][1]=t[1][e],i[r][2]=t[2][e],i[r][3]=t[3][e]})),i},h:function(){for(var e in t){var r=t[e];r&&r.remove()}A&&(A.h(),A=null)}};return e.Na&&w.Md(e.Na),w}};e.Lb=function(e){e.forEach((function(e){e.Sc&&$.Lb(e.Sc.Df),e.fa&&$.Lb(e.fa)}))};var ie={instance:function(e){var t=$.instance(e.weights);return delete e.weights.data,{ja:!0,Ea:function(){return 1},h:function(){t.remove()},od:function(){return t},I:function(){X.set("s26"),t.b(1),q.g(!1,!1)}}}},ne={instance:function(e){var t=e.fromLayerSize,r=$.instance(e.weights);return delete e.weights.data,{ja:!0,Ea:function(){return t},h:function(){r.remove()},I:function(t){if(t.isEnabled){X.set("s24"),t.yd.b(3);var a,i=Math.min(t.layers.length,t.depth);for(a=0;a<i;++a)t.layers[a].Hc(4+a)}else X.set("s23");X.B("u16",e.toLayerSize),r.b(1),q.g(!1,!1)}}}},oe={instance:function(e){for(var t=e.fromLayerSize,r=e.toLayerSize,a=e.toSparsity,i=a*r,n=i/t,o=t/r,u=0,l=0,s=Array(a*r*a*r*4),c=Array(a*r*a*r*4),d=Array(t*t),f=0;f<d.length;++f)d[f]=0;f=Math.floor(a/2);for(var v=.5/r,E=.5/t,m=.5/i,h=0;h<r;++h)for(var g=Math.round(h*o),p=0;p<r;++p){var x=Math.round(p*o),T=h/r,b=p/r;T+=v,b+=v;for(var R=0;R<a;++R){var F=g+R-f;0>F&&(F+=t),F>=t&&(F-=t);for(var _=0;_<a;++_){var A=u/i,w=l/i,y=x+_-f;0>y&&(y+=t),y>=t&&(y-=t);var S=F/t,D=y/t;w=1-w-1/i,S+=E,D+=E,A+=m,w+=m;var M=h*a+R,O=p*a+_;s[4*(M=(O=r*a-O-1)*r*a+M)]=A,s[4*M+1]=w,s[4*M+2]=S,s[4*M+3]=D,D=d[y*t+F]++,c[4*(y=(y=t*n-1-(y=y*n+(D-(M=D%n))/n))*t*n+(S=F*n+M))]=A,c[4*y+1]=w,c[4*y+2]=T,c[4*y+3]=b,++u>=i&&(u=0,++l)}}}d=null;var I=$.instance(e.weights);delete e.weights.data;var C=$.instance({width:i,isFloat:!0,array:new Float32Array(c),isPot:!0});c=null;var L=$.instance({width:i,isFloat:!0,array:new Float32Array(s),isPot:!0});return s=null,{ja:!0,Ea:function(){return n},h:function(){C.remove(),L.remove(),I.remove()},I:function(){X.set("s22"),I.b(1),L.b(2),q.g(!1,!1)}}}},ue={instance:function(e){var t=e.kernelsNumber,r=e.toSparsity,a=r*e.toLayerSize/e.fromLayerSize,i=$.instance(e.weights);return delete e.weights.data,{ja:!0,Ea:function(){return a},Ye:function(){return r},od:function(){return i},h:function(){i.remove()},I:function(){X.set("s25"),X.B("u22",t),X.B("u23",r),X.B("u16",e.toLayerSize),X.B("u24",e.fromLayerSize),i.b(1),q.g(!1,!1)}}}},le={instance:function(e,t){var r=e.fromLayerSize,a=e.toLayerSize,i=e.toSparsity,n=e.stride?e.stride:1,o=i*a/r,u=a<r,l=r/a,s=$.instance(e.weights);delete e.weights.data;var c="s45"+[r.toString(),a.toString(),i.toString(),n.toString(),t].join("_");return X.cd(c)||(e=z(t,"gl_FragColor","gl_FragColor"),a=[{type:"1f",name:"u16",value:a},{type:"1f",name:"u30",value:n}],u&&a.push({type:"1f",name:"u24",value:r}),r=[(u?o:i).toFixed(1),e],u&&r.push(l.toFixed(1)),X.Xb(u?"s39":"s38",c,r),X.K(c,a.concat([{type:"1i",name:"u14",value:0},{type:"1i",name:"u21",value:1},{type:"1i",name:"u13",value:3}]))),{ja:!1,Ea:function(){return o},h:function(){s.remove()},I:function(){X.set(c),s.b(3),q.g(!1,!1)}}}},se={instance:function(e){var t=e.fc?e.fc:3,r=e.Yb?e.Yb:64,a=e.nc?e.nc:64,i=!!e.ud;e={isFloat:!1,width:r,isPot:!1,isFlipY:!1};var n=$.instance(e),o=$.instance(e),u=$.instance(e),l=$.instance(e),s=$.instance({isFloat:!0,width:a,isPot:!1,isFlipY:!1}),c=1/r;return{process:function(e){X.set("s35"),l.l(),q.g(i,!1),X.set("s36");for(var r=0;r<t;++r)n.l(),X.wa("u7",c,0),q.g(i,!1),u.l(),l.b(0),q.g(i,!1),o.l(),n.b(0),X.wa("u7",0,c),q.g(i,!1),l.l(),u.b(0),q.g(i,!1),r!==t-1&&o.b(0);X.set("s37"),s.l(),e.b(0),o.b(1),l.b(2),q.g(i,!1),s.b(0)},Vb:function(){return s}}}},ce={nd:function(){return!!ce.Ib()&&document.createElement("video")},sa:function(e,t){e[t]=!0,e.setAttribute(t,"true")},Pc:function(){var e=!1,t=navigator.userAgent||navigator.vendor||window.opera;return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),e},Gb:function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream},hd:function(){var e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return 2<e.length?[parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3]||0,10)]:[0,0,0]},cc:function(){try{return!!window.matchMedia("(orientation: portrait)").matches}catch(e){return window.innerHeight>window.innerWidth}},Oc:function(){return ce.Hb()||ce.Gb()},Hb:function(){var e=navigator.userAgent.toLowerCase();return-1!==e.indexOf("safari")&&-1===e.indexOf("chrome")},Fe:function(){return ce.Pc()&&ce.cc()?window.innerHeight/window.innerWidth*45:45},Ib:function(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)},pause:function(e){e.pause()},rf:function(e){e.play()},release:function(e){e.pause(),e.videoStream&&e.videoStream.stop(),e.videoStream=null},Rc:function(e){if(!e)return e;var t=!1;if(e.video){var r=function(e){var t={};return void 0!==e.min&&(t.min=e.min),void 0!==e.max&&(t.max=e.max),void 0!==e.ideal&&(t.ideal=e.ideal),t};t={},void 0!==e.video.width&&(t.width=r(e.video.width)),void 0!==e.video.height&&(t.height=r(e.video.height)),void 0!==e.video.facingMode&&(t.facingMode=e.video.facingMode)}return t={audio:e.audio,video:t},void 0!==e.deviceId&&(t.deviceId=e.deviceId),t},tc:function(e){var t=e.video.width;return e.video.width=e.video.height,e.video.height=t,e},Tc:function(e){function t(e){return[480,576,640,648,720,768,800,960,1080,1152,1280,1366,1920].sort((function(t,r){return Math.abs(t-e)-Math.abs(r-e)}))}function r(t){var r=ce.Rc(e);a.push(t(r))}var a=[];if(!e||!e.video)return a;if(e.video.width&&e.video.height){if(e.video.width.ideal&&e.video.height.ideal){var i=t(e.video.width.ideal).slice(0,3),n=t(e.video.height.ideal).slice(0,3),o={},u=0;for(o.Y=void 0;u<i.length;o={Y:o.Y},++u){o.Y=i[u];var l={},s=0;for(l.X=void 0;s<n.length;l={X:l.X},++s)if(l.X=n[s],o.Y!==e.video.width.ideal||l.X!==e.video.height.ideal){var c=Math.max(o.Y,l.X)/Math.min(o.Y,l.X);c<4/3-.1||c>16/9+.1||r(function(e,t){return function(r){return r.video.width.ideal=e.Y,r.video.height.ideal=t.X,r}}(o,l))}}}r((function(e){return ce.tc(e)}))}return e.video.width&&e.video.height&&(e.video.width.ideal&&e.video.height.ideal&&r((function(e){return delete e.video.width.ideal,delete e.video.height.ideal,e})),r((function(e){return delete e.video.width,delete e.video.height,e}))),e.video.facingMode&&(r((function(e){return delete e.video.facingMode,e})),e.video.width&&e.video.height&&r((function(e){return ce.tc(e),delete e.video.facingMode,e}))),a.push({audio:e.audio,video:!0}),a},Td:function(e){if(ce.cc()){if(!e||!e.video)return!1;var t=e.video.width,r=e.video.height;if(!t||!r)return!1;if(t.ideal&&r.ideal&&t.ideal>r.ideal)return e.video.height=t,e.video.width=r,!0}return!1},Ja:function(e){if(e.volume=0,ce.sa(e,"muted"),ce.Hb()){if(1===e.volume){var t=function t(){e.volume=0,window.removeEventListener("mousemove",t,!1),window.removeEventListener("touchstart",t,!1)};window.addEventListener("mousemove",t,!1),window.addEventListener("touchstart",t,!1)}setTimeout((function(){e.volume=0,ce.sa(e,"muted")}),5)}},uc:function(e,t,r){return new Promise((function(a,i){if(e.srcObject&&e.srcObject.getVideoTracks){var n=e.srcObject.getVideoTracks();1!==n.length?i("INVALID_TRACKNUMBER"):(n=n[0],t?ce.get(e,a,i,r):(n.stop(),a()))}else i("BAD_IMPLEMENTATION")}))},Wb:function(e,t,r,a){function i(e){n||(n=!0,r(e))}var n=!1;return navigator.mediaDevices.getUserMedia(a).then((function(r){function a(){setTimeout((function(){if(e.currentTime){var a=e.videoWidth,o=e.videoHeight;if(0===a||0===o)i("VIDEO_NULLSIZE");else{a&&(e.style.width=a.toString()+"px"),o&&(e.style.height=o.toString()+"px"),a={Nc:null,Rd:null,zd:null};try{var u=r.getVideoTracks()[0];u&&(a.zd=u,a.Nc=u.getCapabilities(),a.Rd=u.getSettings())}catch(e){}ce.Oc()?e.parentNode&&null!==e.parentNode?(n||t(e,r,a),setTimeout((function(){e.play()}),100)):(document.body.appendChild(e),ce.Ja(e),n||t(e,r,a),setTimeout((function(){e.style.transform="scale(0.0001,0.0001)",e.style.position="fixed",e.style.bottom="0px",e.style.right="0px",ce.Ja(e),setTimeout((function(){e.play()}),100)}),80)):n||t(e,r,a)}}else i("VIDEO_NOTSTARTED")}),700)}void 0!==e.srcObject?e.srcObject=r:(e.src=window.URL.createObjectURL(r),e.videoStream=r),ce.Ja(e),e.addEventListener("loadeddata",(function(){var t=e.play();ce.Ja(e),void 0===t?a():t.then((function(){a()})).catch((function(){i("VIDEO_PLAYPROMISEREJECTED")}))}),!1)})).catch((function(e){i(e)}))},get:function(e,t,r,a){if(!e)return r&&r("VIDEO_NOTPROVIDED"),!1;if(!ce.Ib())return r&&r("MEDIASTREAMAPI_NOTFOUND"),!1;if(a&&a.video){if(ce.Gb()){var i=ce.hd();(12>i[0]||12===i[0]&&2>i[1])&&ce.Td(a)}a.video.width&&a.video.width.ideal&&(e.style.width=a.video.width.ideal+"px"),a.video.height&&a.video.height.ideal&&(e.style.height=a.video.height.ideal+"px")}ce.sa(e,"autoplay"),ce.sa(e,"playsinline"),a&&a.audio?e.volume=0:ce.sa(e,"muted"),ce.Wb(e,t,(function(){!function a(i){if(0===i.length)r("INVALID_FALLBACKCONSTRAINTS");else{var n=i.shift();ce.Wb(e,t,(function(){a(i)}),n)}}(ce.Tc(a))}),a)},md:function(e){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return e(!1,"NOTSUPPORTED"),!1;navigator.mediaDevices.enumerateDevices().then((function(t){(t=t.filter((function(e){return e.kind&&-1!==e.kind.toLowerCase().indexOf("video")&&e.label&&e.deviceId})))&&t.length&&0<t.length?e(t,!1):e(!1,"NODEVICESFOUND")})).catch((function(){e(!1,"PROMISEREJECTED")}))},ge:function(e,t,r){var a={};a[t]=r,(t=[]).push(a),e.applyConstraints({advanced:t}).catch((function(){}))}},de={save:"NNC.json",Cb:0,Ec:25,Ta:.2,ea:[45,55],be:1/3.5,za:[2,7],Hd:{minScale:.15,maxScale:.6,borderWidth:.2,borderHeight:.2,nStepsX:6,nStepsY:5,nStepsScale:3,nDetectsPerLoop:-1},Ud:50,ec:.5,nb:.4,Ad:8,yc:.8,xc:1,Sd:{translationFactorRange:[.0015,.005],rotationFactorRange:[.003,.02],qualityFactorRange:[.9,.98],alphaRange:[.05,1]},ya:[.65,1,.262],ca:[.092,.092,.3],Bc:.2,Dc:2,Cc:.1,Bd:8,jc:1,dd:G.Ia.bind(null,.3,.7),Zd:20},fe={facingMode:"user",idealWidth:800,idealHeight:600,minWidth:480,maxWidth:1280,minHeight:480,maxHeight:1280,rotate:0,flipX:!1},ve={pb:-3,xd:-1,error:-2,play:1,pause:2},Ee=ve.pb,me=null,he={kb:!1,element:null,W:null,ba:null,v:[0,0],C:[.5,.5],m:[.5,0,0,.5],Oa:0,qa:null,jb:!1},ge=null,pe={pa:null,Ca:null,zb:"./",la:null,V:null,Aa:de.Cb,oc:de.Cb,Ha:!1,ga:!1},xe=null,Te=null,be=null,Re=a=n=i=r=t=u=o=E=v=f=d=c=s=l=0,Fe=null,_e={M:0,O:0,v:[0,0],Ga:null},Ae={Qa:null,buffer:null,ca:null,ya:null,R:de.jc,ta:null},we=null,ye=null,Se=null,De=null,Me={i:1,$:0,L:null,ac:!1,dc:0,qb:0},Oe={ra:0,timestamp:0,hc:0,ic:0,F:de.za[0],ob:de.za[0],kc:0,ia:0,le:1},Ie=[],Ce=[],Le={VERSION:"1.2.9",init:function(t){function r(){Ee!==ve.error&&2==++i&&(I(),M(),O(),ge.pa&&(ge.pa(!1,{GL:k,canvasElement:ge.V,videoTexture:me.ba.get(),maxFacesDetected:Me.i,videoElement:me.element}),b()),p())}if(Ee!==ve.pb)return t.callbackReady&&t.callbackReady("ALREADY_INITIALIZED"),!1;if(Ee=ve.xd,me=Object.assign({},he),ge=Object.assign({},pe),Fe=Object.assign({},_e),Me.L=[0],Ae.ca=de.ca.slice(0),Ae.ya=de.ya.slice(0),t.callbackReady&&(ge.pa=t.callbackReady),t.callbackTrack&&(ge.Ca=t.callbackTrack),t.nExpressions&&(Ae.R=t.nExpressions),t.expressionsEasings&&(Ae.ta=t.expressionsEasings),void 0!==t.animateDelay&&(ge.Aa=t.animateDelay),void 0!==t.NNCpath&&(ge.zb=t.NNCpath),void 0!==t.NNC&&(ge.la=t.NNC),void 0!==t.maxFacesDetected&&(Me.i=Math.max(1,t.maxFacesDetected)),void 0!==t.followZRot&&(ge.ga=!!t.followZRot),Me.i>de.Ad)return B("MAXFACES_TOOHIGH"),!1;if(!t.canvasId&&!t.canvas)return B("NO_CANVASID"),!1;if(ge.V=t.canvas?t.canvas:document.getElementById(t.canvasId),!ge.V)return B("INVALID_CANVASID"),!1;if(Fe.M=ge.V.width,Fe.O=ge.V.height,!Fe.M||!Fe.O)return B("INVALID_CANVASDIMENSIONS"),!1;for(var a=0;a<Me.i;++a)Ie.push(new Float32Array(de.Bd)),Ce.push(0);Te=Object.create(de.Hd),t.scanSettings&&(Object.assign(Te,t.scanSettings),-1!==Te.nDetectsPerLoop&&(Oe.F=Te.nDetectsPerLoop,Oe.ob=Te.nDetectsPerLoop)),be=Object.create(de.Sd),t.stabilizationSettings&&Object.assign(be,t.stabilizationSettings);var i=0;return t.videoSettings&&t.videoSettings.videoElement?L(t.videoSettings.videoElement,r):(t.videoSettings&&Object.assign(fe,t.videoSettings),U(t.onWebcamAsk,t.onWebcamGet,(function(e){L(e,r)}))),function(e){if(ge.la)A("string"==typeof ge.la?JSON.parse(ge.la):ge.la,e);else{var t=ge.zb;"JSON"!==t.toUpperCase().split(".").pop()&&(t+=de.save),H.get(t,(function(t){A(t=JSON.parse(t),e)}))}}((function(t){if(!(j.o({Ua:ge.V,width:Fe.M,height:Fe.O,debug:!1,lc:function(){B("GLCONTEXT_LOST")},antialias:!0,premultipliedAlpha:!0})&&j.qd()||(B("GL_INCOMPATIBLE"),0)))return!1;(xe=new e({})).Jd(t.layers),xe.Ld({mc:"gpuRawAvg",Dd:D}),X.Ac([{id:"s48",name:"_",da:"attribute vec2 a0;uniform mat2 u32;varying vec2 vv0;void main(){gl_Position=vec4(a0,0.,1.),vv0=vec2(.5,.5)+u32*a0*vec2(1.,-1.);}",Ba:["a0"],ma:[2],a:"uniform sampler2D u1;varying vec2 vv0;void main(){gl_FragColor=texture2D(u1,vv0);}",c:["u1","u32"],precision:"lowp"},{id:"s49",name:"_",a:"uniform sampler2D u1;varying vec2 vv0;void main(){gl_FragColor=texture2D(u1,vv0);}",da:"attribute vec2 a0;uniform sampler2D u33;uniform vec2 u34;uniform float u35,u36;varying vec2 vv0;void main(){vec4 a=texture2D(u33,vec2(.17,u35));vec2 d=a.gb,f=a.a*u34;float b=cos(u36),c=sin(u36);vec2 g=mat2(b,c,-c,b)*a0;vv0=d+g*.5*f,gl_Position=vec4(a0,0.,1.);}",Ba:["a0"],ma:[2],c:["u1","u33","u34","u35","u36"],precision:"lowp"},{id:"s50",name:"_",a:"uniform sampler2D u37,u33;uniform vec3 u38,u39;uniform float u40,u41,u42,u35,u43,u36,u44;const vec4 e=vec4(.25,.25,.25,.25);void main(){vec4 f=texture2D(u37,vec2(.625,.625)),g=texture2D(u37,vec2(.875,.625)),a=texture2D(u33,vec2(.17,u35));float b=dot(f,e),h=dot(g,e);bool i=b>u41&&b>h+u42;i?a.r=2.:a.r>u40?a.r=0.:a.r>1.9?a.r+=1.:0.,a.r*=u43;if(a.r<.9)a=vec4(1.,u38);else{a.r*=step(1.9,a.r);float j=dot(e,texture2D(u37,vec2(.875,.875))),k=dot(e,texture2D(u37,vec2(.125,.625))),l=dot(e,texture2D(u37,vec2(.375,.625))),c=cos(u36),d=sin(u36);vec2 m=mat2(c,d*u44,-d/u44,c)*vec2(j,k);a.gba+=vec3(m,l)*u39*a.a;}gl_FragColor=a;}",da:"attribute vec2 a0;void main(){gl_Position=vec4(a0,0.,1.);}",c:"u37 u33 u38 u40 u39 u43 u36 u44 u41 u42 u35".split(" ")},{id:"s51",name:"_",da:"attribute vec2 a0;void main(){gl_Position=vec4(a0,0.,1.);}",a:"uniform sampler2D u37;const vec4 e=vec4(.25,.25,.25,.25);const vec3 f=vec3(.5,.5,.5);void main(){float a=dot(e,texture2D(u37,vec2(.125,.875))),b=dot(e,texture2D(u37,vec2(.375,.875))),c=dot(e,texture2D(u37,vec2(.625,.875))),d=dot(e,texture2D(u37,vec2(.625,.625)));vec3 g=vec3(a,b,c)*.5+f;gl_FragColor=vec4(g,d);}",c:["u37"]},{id:"s52",name:"_",da:"attribute vec2 a0;void main(){gl_Position=vec4(a0,0.,1.);}",a:"uniform sampler2D u37;const vec4 e=vec4(.25,.25,.25,.25);void main(){float a=dot(e,texture2D(u37,vec2(.375,.375))),b=dot(e,texture2D(u37,vec2(.625,.375))),c=dot(e,texture2D(u37,vec2(.875,.375))),d=dot(e,texture2D(u37,vec2(.125,.125)));gl_FragColor=vec4(a,b,c,d);}",c:["u37"]},{id:"s47",name:"_",a:"uniform sampler2D u33;uniform vec2 u45;uniform float u46;varying vec2 vv0;void main(){float f=step(.5,mod(gl_FragCoord.y+1.5,2.)),c=step(.33,vv0.x);vec4 a=texture2D(u33,vv0+u45);a.a=mix(a.a*u46,a.a,c);vec4 d=floor(255.*a),g=255.*(255.*a-d),b=mix(d,g,f)/255.;b.x=mix(step(a.x,1.5),b.x,c),gl_FragColor=b;}",c:["u33","u46","u45"]}]),function(){function e(e){for(var t=[],r=0;r<Me.i;++r)t.push(JSON.parse(JSON.stringify(e)));return t}me.ba=$.instance({isPot:!1,isLinear:!0,isFloat:!1,width:Fe.M,height:Fe.O}),Fe.Ga=$.instance({isPot:!0,isFloat:!1,width:xe.Tb()});var t={width:3,height:Me.i,isFloat:!0,isPot:!1,array:function(e){for(var t,r=new Float32Array(e.length*Me.i),a=0;a<Me.i;++a)for(t=0;t<e.length;++t)r[a*e.length+t]=e[t];return r}(new Float32Array([0,Te.borderWidth,Te.borderHeight,0,0,0,0,0,0,0,0,0]))};Ae.Qa=K.instance(t),Ae.buffer=new Uint8Array(8*t.width*Me.i),we=e({Da:0,x:0,y:0,T:1,tb:0,ub:0,va:0,Ob:new Float32Array(Ae.R),La:0}),ye=e({detected:0,x:0,y:0,s:1,rx:0,ry:0,rz:0,expressions:new Float32Array(Ae.R)}),e({Za:0,$a:0,Ya:0,Va:0,Wa:0,Xa:0})}(),_(),F(),r()})),!0},destroy:function(){return new Promise((function(e,t){Le.toggle_pause(!0,!0).catch((function(){t()})).then((function(){xe&&xe.h(),j.h(),xe=ye=we=null,Ie.splice(0),Ce.splice(0),Ee=ve.pb,e()}))}))},toggle_pause:function(e,t){return h()?(t=t?ce.uc(me.element,!e,me.qa):Promise.resolve(),e?x():p(),t):Promise.reject()},update_videoSettings:function(e){return x(),new Promise((function(t){ce.uc(me.element,!1,me.qa).then((function(){Object.assign(fe,e),U(null,null,(function(e){L(e,(function(){I(),O(),p(),t()}))}))}))}))},toggle_slow:function(e){h()&&Ee===ve.play&&(e&&!ge.Ha?(ge.oc=ge.Aa,Te.nDetectsPerLoop=1,this.set_animateDelay(100),ge.Ha=!0):!e&&ge.Ha&&(Te.nDetectsPerLoop=-1,this.set_animateDelay(ge.oc),ge.Ha=!1))},set_animateDelay:function(e){ge.Aa=e},resize:function(){var e=ge.V.width,t=ge.V.height;return!(!C()&&e===Fe.M&&t===Fe.O||(Fe.M=e,Fe.O=t,_(),F(),I(),O(),me.ba&&me.ba.resize(Fe.M,Fe.O),0))},set_inputTexture:function(e,t,r){me.v[0]=t,me.v[1]=r,me.kb=!0,I(),b(),O(),X.set("s48"),me.ba.J(),k.activeTexture(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,e),q.g(!0,!0)},reset_inputTexture:function(){C(),me.kb=!1,I(),O()},get_videoDevices:function(e){return ce.md(e)},set_scanSettings:function(e){Object.assign(Te,e),-1!==Te.nDetectsPerLoop&&(Oe.F=Te.nDetectsPerLoop,Oe.ob=Te.nDetectsPerLoop),_(),F()},set_stabilizationSettings:function(e){Object.assign(be,e)},set_videoOrientation:function(e,t){h()&&(fe.flipX=t,fe.rotate=e,I(),O())},update_videoElement:function(e,t){L(e||me.element,(function(){M(),I(),O(),t&&t()}))}};return Le},window.JEEFACEFILTERAPI=window.JEEFACEFILTERAPIGEN(),JEEFACEFILTERAPI),JeelizResizer=function(){var e=null,t=null,r=0,a=1,i=!1,n=!1,o=!1,u=!1,l=[[640,480],[768,480],[800,600],[960,640],[960,720],[1024,768],[1280,720],[1920,1080]];function s(e,t){var r,a;e[0]/e[1]>t[0]/t[1]?(r=e,a=t):(r=t,a=e);var i,n=Math.min(r[0],a[0])*Math.min(r[1],a[1]);return r[0]>=a[0]&&r[1]>=a[1]?i=r[0]*r[1]:a[0]>r[0]&&a[1]>r[1]?i=a[0]*a[1]:(i=r[0]*r[1],i+=(a[1]-r[1])*a[0]),n/i}function c(){var r=e.getBoundingClientRect();t=[Math.round(a*r.width),Math.round(a*r.height)],e.setAttribute("width",t[0]),e.setAttribute("height",t[1])}function d(){n&&clearTimeout(n),n=setTimeout(v,50)}function f(){t=[window.innerWidth,window.innerHeight],u&&t.reverse(),e.setAttribute("width",t[0]),e.setAttribute("height",t[1])}function v(){f(),JEEFACEFILTERAPI.resize(),n=!1,o&&o()}var E={is_portrait:function(){try{return!!window.matchMedia("(orientation: portrait)").matches}catch(e){return window.innerHeight>window.innerWidth}},check_isIOS:function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream},get_IOSVersion:function(){var e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return e.length>2?[parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3]||0,10)]:[0,0,0]},check_isAndroid:function(){return-1!==navigator.userAgent.toLowerCase().indexOf("android")},get_androidVersion:function(){var e=navigator.userAgent.toLowerCase().match(/android\s([0-9\.]*)/i);if(!e||e.length<2)return[0,0,0];var t=e[1].split(".");return[parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2]||0,10)]},require_flipVideoWHIfPortrait:function(){return!0},size_canvas:function(n){if(e=n.canvas?n.canvas:document.getElementById(n.canvasId),i=void 0!==n.isFullScreen&&n.isFullScreen,u=void 0!==n.isInvWH&&n.isInvWH,i)void 0!==n.onResize&&(o=n.onResize),f(),window.addEventListener("resize",d,!1),window.addEventListener("orientationchange",d,!1);else{var v=e.getBoundingClientRect();if(0===v.width||0===v.height)return console.log("WARNING in JeelizResize.size_canvas(): the canvas has its width or its height null, Retry a bit later..."),++r>20?void n.callback("CANNOT_RESIZECANVAS"):void setTimeout(E.size_canvas.bind(null,n),50);r=0,a=void 0===n.overSamplingFactor?1:n.overSamplingFactor,c()}var m,h,g;void 0!==n.CSSFlipX&&n.CSSFlipX&&(h="rotateY(180deg)",-1===(g=(m=e).style.transform).indexOf(h)&&(m.style.transform=h+" "+g));var p=l.map((function(e){return e.slice(0)}));E.is_portrait()&&E.require_flipVideoWHIfPortrait()&&p.forEach((function(e){e.reverse()}));var x=window.devicePixelRatio?window.devicePixelRatio:1,T=[t[0]*x,t[1]*x];p.sort((function(e,t){return s(t,T)-s(e,T)}));var b={idealWidth:p[0][0],idealHeight:p[0][1]};console.log("INFO in JeelizResizer: bestCameraResolution =",b),setTimeout(n.callback.bind(null,!1,b),1)},resize_canvas:function(){i||c()}};return E}();THREE.JeelizHelper=function(){var e={rotationOffsetX:0,pivotOffsetYZ:[.4,.2],detectionThreshold:.8,detectionHysteresis:.05,tweakMoveYRotateY:.5,cameraMinVideoDimFov:46,isDebugPivotPoint:!1},t=null,r=null,a=null,i=null,n=-1,o=!1,u=null,l=!1,s=!1,c=null,d=null,f=!1,v=1,E=[],m=[],h=null,g=null,p=null;function x(t){E.forEach((function(r,a){f=r.visible;var i=t[a];f&&i.detected<e.detectionThreshold-e.detectionHysteresis?(u&&u(a,!1),r.visible=!1):!f&&i.detected>e.detectionThreshold+e.detectionHysteresis&&(u&&u(a,!0),r.visible=!0)}))}var T={init:function(f,v){l=!1,E.splice(0),m.splice(0),i&&(i.dispose(),i=null),n=f.maxFacesDetected,g=f.videoTexture,h=f.GL,c=f.canvasElement,o=n>1,d=f.videoElement;var x=null;f.threejsCanvasId?(s=!0,(x=document.getElementById(f.threejsCanvasId)).setAttribute("width",c.width),x.setAttribute("height",c.height)):x=c,void 0!==v&&(u=v),t=new THREE.WebGLRenderer({context:s?null:h,canvas:x,alpha:!(!s&&!f.alpha)}),r=new THREE.Scene,function(){for(var t=0;t<n;++t){var a=new THREE.Object3D;a.frustumCulled=!1,a.visible=!1;var i=new THREE.Object3D;if(i.frustumCulled=!1,a.add(i),E.push(a),m.push(i),r.add(a),e.isDebugPivotPoint){var o=new THREE.Mesh(new THREE.BoxGeometry(.1,.1,.1),new THREE.MeshNormalMaterial({side:THREE.DoubleSide,depthTest:!1}));o.position.copy(i.position),a.add(o),window.pivot=o,console.log("DEBUG in JeelizHelper: set the position of <pivot> in the console and report the value into JeelizThreejsHelper.js for _settings.pivotOffsetYZ")}}}(),function(){var e="attribute vec2 position;\n        varying vec2 vUV;\n        void main(void){\n          gl_Position = vec4(position, 0., 1.);\n          vUV = 0.5+0.5*position;\n        }",t="precision lowp float;\n        uniform sampler2D samplerVideo;\n        varying vec2 vUV;\n        void main(void){\n          gl_FragColor = texture2D(samplerVideo, vUV);\n        }";if(s){var n=function(e,t,r){var a=h.createShader(t);return h.shaderSource(a,e),h.compileShader(a),h.getShaderParameter(a,h.COMPILE_STATUS)?a:(alert("ERROR IN "+r+" SHADER: "+h.getShaderInfoLog(a)),!1)},o=n(e,h.VERTEX_SHADER,"VERTEX"),u=n(t,h.FRAGMENT_SHADER,"FRAGMENT");p=h.createProgram(),h.attachShader(p,o),h.attachShader(p,u),h.linkProgram(p);h.getUniformLocation(p,"samplerVideo")}else{(i=new THREE.DataTexture(new Uint8Array([255,0,0]),1,1,THREE.RGBFormat)).needsUpdate=!0;var l=new THREE.RawShaderMaterial({depthWrite:!1,depthTest:!1,vertexShader:e,fragmentShader:t,uniforms:{samplerVideo:{value:i}}}),c=new THREE.BufferGeometry,d=new Float32Array([-1,-1,1,-1,1,1,-1,1]);c.addAttribute("position",new THREE.BufferAttribute(d,2)),c.setIndex(new THREE.BufferAttribute(new Uint16Array([0,1,2,0,2,3]),1)),a=new THREE.Mesh(c,l),T.apply_videoTexture(a),a.renderOrder=-1e3,a.frustumCulled=!1,r.add(a)}}(),window.addEventListener("orientationchange",(function(){setTimeout(JEEFACEFILTERAPI.resize,1e3)}),!1);var b={videoMesh:a,renderer:t,scene:r};return o?b.faceObjects=m:b.faceObject=m[0],b},detect:function(e){x(o?e:[e])},get_isDetected:function(){return f},render:function(a,i){var n=o?a:[a];x(n),function(t,r){var a=Math.tan(r.aspect*r.fov*Math.PI/360);E.forEach((function(i,n){if(i.visible){var o=t[n],u=e.tweakMoveYRotateY*Math.tan(o.rx),l=Math.cos(o.rz),s=Math.sin(o.rz),c=o.s*v,d=s*u*c,f=l*u*(c*r.aspect),E=1/(2*c*a),h=o.x*v+d,g=o.y+f,p=-E-.5,x=h*E*a,T=g*E*a/r.aspect;m[n].position.set(-s*e.pivotOffsetYZ[0],-l*e.pivotOffsetYZ[0],-e.pivotOffsetYZ[1]),i.position.set(x,T+e.pivotOffsetYZ[0],p+e.pivotOffsetYZ[1]),i.rotation.set(o.rx+e.rotationOffsetX,o.ry,o.rz,"ZXY")}}))}(n,i),s?(h.viewport(0,0,c.width,c.height),h.useProgram(p),h.activeTexture(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,g),h.drawElements(h.TRIANGLES,3,h.UNSIGNED_SHORT,0)):t.state.reset(),t.render(r,i)},sortFaces:function(e,t,r){for(var a={X:0,Y:1,Z:2}[t.toUpperCase()],i=r?-1:1,n=e.index.count/3,o=new Array(n),u=0;u<n;++u)o[u]=[e.index.array[3*u],e.index.array[3*u+1],e.index.array[3*u+2]];var l=e.attributes.position.array,s=o.map((function(e,t){return[(l[3*e[0]]+l[3*e[1]]+l[3*e[2]])/3,(l[3*e[0]+1]+l[3*e[1]+1]+l[3*e[2]+1])/3,(l[3*e[0]+2]+l[3*e[1]+2]+l[3*e[2]+2])/3,e]}));s.sort((function(e,t){return(e[a]-t[a])*i})),s.forEach((function(t,r){var a=t[3];e.index.array[3*r]=a[0],e.index.array[3*r+1]=a[1],e.index.array[3*r+2]=a[2]}))},get_threeVideoTexture:function(){return i},apply_videoTexture:function(e){l||(e.onAfterRender=function(){try{t.properties.update(i,"__webglTexture",g),i.magFilter=THREE.LinearFilter,i.minFilter=THREE.LinearFilter,l=!0}catch(e){console.log("WARNING in THREE.JeelizHelper: the glVideoTexture is not fully initialized")}delete e.onAfterRender})},create_threejsOccluder:function(e,t){var r=new THREE.Mesh;return(new THREE.BufferGeometryLoader).load(e,(function(e){var a=new THREE.ShaderMaterial({vertexShader:THREE.ShaderLib.basic.vertexShader,fragmentShader:"precision lowp float;\n void main(void){\n gl_FragColor=vec4(1.,0.,0.,1.);\n }",uniforms:THREE.ShaderLib.basic.uniforms,colorWrite:!1});r.renderOrder=-1,r.material=a,r.geometry=e,void 0!==t&&t&&t(r)})),r},set_pivotOffsetYZ:function(t){e.pivotOffsetYZ=t},create_camera:function(e,t){var r=new THREE.PerspectiveCamera(1,1,e||.1,t||100);return T.update_camera(r),r},update_camera:function(r){var a=t.domElement,i=a.width,n=a.height,o=i/n,u=d.videoWidth,l=d.videoHeight,s=u/l,c=l>u?1/s:1,f=e.cameraMinVideoDimFov*c,E=1,m=u*(E=o>s?i/u:n/l),h=l*E,g=(m-i)/2,p=(h-n)/2;v=i/m,r.aspect=o,r.fov=f,console.log("INFO in JeelizThreejsHelper.update_camera(): camera vertical estimated FoV is",f,"deg"),r.setViewOffset(m,h,g,p,i,n),r.updateProjectionMatrix(),t.setSize(i,n,!1),t.setViewport(0,0,i,n)},resize:function(e,r,a){t.domElement.width=e,t.domElement.height=r,JEEFACEFILTERAPI.resize(),a&&T.update_camera(a)}};return T}(),THREE.FlexMaterial=function(e){var t=new THREE.Matrix4;function r(e,t,r){e.set(t.x*r+e.x*(1-r),t.y*r+e.y*(1-r),t.z*r+e.z*(1-r))}var a,i,n=THREE.ShaderLib.phong,o=n.vertexShader;a="#include <common>",i="uniform mat4 modelMatrixDelayed;\nuniform sampler2D flexMap;\n",o=function(e,t,r){return e.replace(t,r)}(o=function(e,t){return e.replace(t,"")}(o=o.replace(a,a+"\n"+i),"#include <worldpos_vertex>"),"#include <project_vertex>","vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n        vec4 worldPositionDelayed = modelMatrixDelayed * vec4( transformed, 1.0 );\n        worldPosition = mix(worldPosition, worldPositionDelayed, texture2D(flexMap, uv).r);\n        vec4 mvPosition = viewMatrix* worldPosition;\n        gl_Position = projectionMatrix * mvPosition;");var u={modelMatrixDelayed:{value:t},flexMap:{value:e.flexMap},opacity:{value:void 0!==e.opacity?e.opacity:1}},l=Object.assign({},n.uniforms,u),s=!!e.morphTargets,c=new THREE.ShaderMaterial({vertexShader:o,fragmentShader:n.fragmentShader,uniforms:l,transparent:!!e.transparent,lights:!0,morphTargets:s,morphNormals:s});c.flexMap=e.flexMap,c.opacity=c.uniforms.opacity,void 0!==e.map&&(l.map={value:e.map},c.map=e.map),void 0!==e.alphaMap&&(l.alphaMap={value:e.alphaMap},c.transparent=!0,c.alphaMap=e.alphaMap),void 0!==e.bumpMap&&(l.bumpMap={value:e.bumpMap},c.bumpMap=e.bumpMap),void 0!==e.bumpScale&&(l.bumpScale={value:e.bumpScale},c.bumpScale=e.bumpScale),void 0!==e.shininess&&(l.shininess={value:e.shininess},c.shininess=e.shininess);var d=new THREE.Vector3,f=new THREE.Vector3,v=new THREE.Euler,E=!1;return c.set_amortized=function(e,a,i,n,o){E||(e&&d.copy(e),a&&f.copy(a),i&&v.copy(i),E=!0),i&&(r(v,i,o),t.makeRotationFromEuler(v)),e&&(r(d,e,o),t.setPosition(d)),a&&(r(f,a,o),t.scale(f)),n&&t.multiplyMatrices(n,t)},c};var Filters,fx=function(){function e(e,t,r){return Math.max(e,Math.min(t,r))}function t(e){return{_:e,loadContentsOf:function(e){N=this._.gl,this._.loadContentsOf(e)},destroy:function(){N=this._.gl,this._.destroy()}}}function r(e){return t(z.fromElement(e))}function a(e,t){var r=N.UNSIGNED_BYTE;if(N.getExtension("OES_texture_float")&&N.getExtension("OES_texture_float_linear")){var a=new z(100,100,N.RGBA,N.FLOAT);try{a.drawTo((function(){r=N.FLOAT}))}catch(e){}a.destroy()}this._.texture&&this._.texture.destroy(),this._.spareTexture&&this._.spareTexture.destroy(),this.width=e,this.height=t,this._.texture=new z(e,t,N.RGBA,r),this._.spareTexture=new z(e,t,N.RGBA,r),this._.extraTexture=this._.extraTexture||new z(0,0,N.RGBA,r),this._.flippedShader=this._.flippedShader||new G(null,"uniform sampler2D texture;varying vec2 texCoord;void main(){gl_FragColor=texture2D(texture,vec2(texCoord.x,1.0-texCoord.y));}"),this._.isInitialized=!0}function i(e,t,r){return this._.isInitialized&&e._.width==this.width&&e._.height==this.height||a.call(this,t||e._.width,r||e._.height),e._.use(),this._.texture.drawTo((function(){G.getDefaultShader().drawRect()})),this}function n(){return this._.texture.use(),this._.flippedShader.drawRect(),this}function o(e,t,r,a){(r||this._.texture).use(),this._.spareTexture.drawTo((function(){e.uniforms(t).drawRect()})),this._.spareTexture.swapWith(a||this._.texture)}function u(e){return e.parentNode.insertBefore(this,e),e.parentNode.removeChild(e),this}function l(){var e=new z(this._.texture.width,this._.texture.height,N.RGBA,N.UNSIGNED_BYTE);return this._.texture.use(),e.drawTo((function(){G.getDefaultShader().drawRect()})),t(e)}function s(){var e=this._.texture.width,t=this._.texture.height,r=new Uint8Array(4*e*t);return this._.texture.drawTo((function(){N.readPixels(0,0,e,t,N.RGBA,N.UNSIGNED_BYTE,r)})),r}function c(e){return function(){return N=this._.gl,e.apply(this,arguments)}}function d(e,t,r,a,i,n,o,u){var l,s,c=a-n,d=u-n,f=(s=r-i)*d-(l=o-i)*c;return[r-e+(l=((i=e-r+i-o)*d-l*(n=t-a+n-u))/f)*r,a-t+l*a,l,o-e+(s=(s*n-i*c)/f)*o,u-t+s*u,s,e,t,1]}function f(e){var t=e[0],r=e[1],a=e[2],i=e[3],n=e[4],o=e[5],u=e[6],l=e[7],s=t*n*(e=e[8])-t*o*l-r*i*e+r*o*u+a*i*l-a*n*u;return[(n*e-o*l)/s,(a*l-r*e)/s,(r*o-a*n)/s,(o*u-i*e)/s,(t*e-a*u)/s,(a*i-t*o)/s,(i*l-n*u)/s,(r*u-t*l)/s,(t*n-r*i)/s]}function v(e){var t=e.length;this.xa=[],this.ya=[],this.u=[],this.y2=[],e.sort((function(e,t){return e[0]-t[0]}));for(var r=0;r<t;r++)this.xa.push(e[r][0]),this.ya.push(e[r][1]);for(this.u[0]=0,this.y2[0]=0,r=1;r<t-1;++r){e=this.xa[r+1]-this.xa[r-1];var a=(this.xa[r]-this.xa[r-1])/e,i=a*this.y2[r-1]+2;this.y2[r]=(a-1)/i,this.u[r]=(6*((this.ya[r+1]-this.ya[r])/(this.xa[r+1]-this.xa[r])-(this.ya[r]-this.ya[r-1])/(this.xa[r]-this.xa[r-1]))/e-a*this.u[r-1])/i}for(this.y2[t-1]=0,r=t-2;0<=r;--r)this.y2[r]=this.y2[r]*this.y2[r+1]+this.u[r]}function E(e,t){return new G(null,e+"uniform sampler2D texture;uniform vec2 texSize;varying vec2 texCoord;void main(){vec2 coord=texCoord*texSize;"+t+"gl_FragColor=texture2D(texture,coord/texSize);vec2 clampedCoord=clamp(coord,vec2(0.0),texSize);if(coord!=clampedCoord){gl_FragColor.a*=max(0.0,1.0-length(coord-clampedCoord));}}")}function m(t,r){return N.brightnessContrast=N.brightnessContrast||new G(null,"uniform sampler2D texture;uniform float brightness;uniform float contrast;varying vec2 texCoord;void main(){vec4 color=texture2D(texture,texCoord);color.rgb+=brightness;if(contrast>0.0){color.rgb=(color.rgb-0.5)/(1.0-contrast)+0.5;}else{color.rgb=(color.rgb-0.5)*(1.0+contrast)+0.5;}gl_FragColor=color;}"),o.call(this,N.brightnessContrast,{brightness:e(-1,t,1),contrast:e(-1,r,1)}),this}function h(t){t=new v(t);for(var r=[],a=0;256>a;a++)r.push(e(0,Math.floor(256*t.interpolate(a/255)),255));return r}function g(e,t,r){e=h(e),1==arguments.length?t=r=e:(t=h(t),r=h(r));for(var a=[],i=0;256>i;i++)a.splice(a.length,0,e[i],t[i],r[i],255);return this._.extraTexture.initFromBytes(256,1,a),this._.extraTexture.use(1),N.curves=N.curves||new G(null,"uniform sampler2D texture;uniform sampler2D map;varying vec2 texCoord;void main(){vec4 color=texture2D(texture,texCoord);color.r=texture2D(map,vec2(color.r)).r;color.g=texture2D(map,vec2(color.g)).g;color.b=texture2D(map,vec2(color.b)).b;gl_FragColor=color;}"),N.curves.textures({map:1}),o.call(this,N.curves,{}),this}function p(e){N.denoise=N.denoise||new G(null,"uniform sampler2D texture;uniform float exponent;uniform float strength;uniform vec2 texSize;varying vec2 texCoord;void main(){vec4 center=texture2D(texture,texCoord);vec4 color=vec4(0.0);float total=0.0;for(float x=-4.0;x<=4.0;x+=1.0){for(float y=-4.0;y<=4.0;y+=1.0){vec4 sample=texture2D(texture,texCoord+vec2(x,y)/texSize);float weight=1.0-abs(dot(sample.rgb-center.rgb,vec3(0.25)));weight=pow(weight,exponent);color+=sample*weight;total+=weight;}}gl_FragColor=color/total;}");for(var t=0;2>t;t++)o.call(this,N.denoise,{exponent:Math.max(0,e),texSize:[this.width,this.height]});return this}function x(t,r){return N.hueSaturation=N.hueSaturation||new G(null,"uniform sampler2D texture;uniform float hue;uniform float saturation;varying vec2 texCoord;void main(){vec4 color=texture2D(texture,texCoord);float angle=hue*3.14159265;float s=sin(angle),c=cos(angle);vec3 weights=(vec3(2.0*c,-sqrt(3.0)*s-c,sqrt(3.0)*s-c)+1.0)/3.0;float len=length(color.rgb);color.rgb=vec3(dot(color.rgb,weights.xyz),dot(color.rgb,weights.zxy),dot(color.rgb,weights.yzx));float average=(color.r+color.g+color.b)/3.0;if(saturation>0.0){color.rgb+=(average-color.rgb)*(1.0-1.0/(1.001-saturation));}else{color.rgb+=(average-color.rgb)*(-saturation);}gl_FragColor=color;}"),o.call(this,N.hueSaturation,{hue:e(-1,t,1),saturation:e(-1,r,1)}),this}function T(t){return N.noise=N.noise||new G(null,"uniform sampler2D texture;uniform float amount;varying vec2 texCoord;float rand(vec2 co){return fract(sin(dot(co.xy,vec2(12.9898,78.233)))*43758.5453);}void main(){vec4 color=texture2D(texture,texCoord);float diff=(rand(texCoord)-0.5)*amount;color.r+=diff;color.g+=diff;color.b+=diff;gl_FragColor=color;}"),o.call(this,N.noise,{amount:e(0,t,1)}),this}function b(t){return N.sepia=N.sepia||new G(null,"uniform sampler2D texture;uniform float amount;varying vec2 texCoord;void main(){vec4 color=texture2D(texture,texCoord);float r=color.r;float g=color.g;float b=color.b;color.r=min(1.0,(r*(1.0-(0.607*amount)))+(g*(0.769*amount))+(b*(0.189*amount)));color.g=min(1.0,(r*0.349*amount)+(g*(1.0-(0.314*amount)))+(b*0.168*amount));color.b=min(1.0,(r*0.272*amount)+(g*0.534*amount)+(b*(1.0-(0.869*amount))));gl_FragColor=color;}"),o.call(this,N.sepia,{amount:e(0,t,1)}),this}function R(e,t){return N.unsharpMask=N.unsharpMask||new G(null,"uniform sampler2D blurredTexture;uniform sampler2D originalTexture;uniform float strength;uniform float threshold;varying vec2 texCoord;void main(){vec4 blurred=texture2D(blurredTexture,texCoord);vec4 original=texture2D(originalTexture,texCoord);gl_FragColor=mix(blurred,original,1.0+strength);}"),this._.extraTexture.ensureFormat(this._.texture),this._.texture.use(),this._.extraTexture.drawTo((function(){G.getDefaultShader().drawRect()})),this._.extraTexture.use(1),this.triangleBlur(e),N.unsharpMask.textures({originalTexture:1}),o.call(this,N.unsharpMask,{strength:t}),this._.extraTexture.unuse(1),this}function F(t){return N.vibrance=N.vibrance||new G(null,"uniform sampler2D texture;uniform float amount;varying vec2 texCoord;void main(){vec4 color=texture2D(texture,texCoord);float average=(color.r+color.g+color.b)/3.0;float mx=max(color.r,max(color.g,color.b));float amt=(mx-average)*(-amount*3.0);color.rgb=mix(color.rgb,vec3(mx),amt);gl_FragColor=color;}"),o.call(this,N.vibrance,{amount:e(-1,t,1)}),this}function _(t,r){return N.vignette=N.vignette||new G(null,"uniform sampler2D texture;uniform float size;uniform float amount;varying vec2 texCoord;void main(){vec4 color=texture2D(texture,texCoord);float dist=distance(texCoord,vec2(0.5,0.5));color.rgb*=smoothstep(0.8,size*0.799,dist*(amount+size));gl_FragColor=color;}"),o.call(this,N.vignette,{size:e(0,t,1),amount:e(0,r,1)}),this}function A(t,r,a){N.lensBlurPrePass=N.lensBlurPrePass||new G(null,"uniform sampler2D texture;uniform float power;varying vec2 texCoord;void main(){vec4 color=texture2D(texture,texCoord);color=pow(color,vec4(power));gl_FragColor=vec4(color);}");var i="uniform sampler2D texture0;uniform sampler2D texture1;uniform vec2 delta0;uniform vec2 delta1;uniform float power;varying vec2 texCoord;"+X+"vec4 sample(vec2 delta){float offset=random(vec3(delta,151.7182),0.0);vec4 color=vec4(0.0);float total=0.0;for(float t=0.0;t<=30.0;t++){float percent=(t+offset)/30.0;color+=texture2D(texture0,texCoord+delta*percent);total+=1.0;}return color/total;}";N.lensBlur0=N.lensBlur0||new G(null,i+"void main(){gl_FragColor=sample(delta0);}"),N.lensBlur1=N.lensBlur1||new G(null,i+"void main(){gl_FragColor=(sample(delta0)+sample(delta1))*0.5;}"),N.lensBlur2=N.lensBlur2||new G(null,i+"void main(){vec4 color=(sample(delta0)+2.0*texture2D(texture1,texCoord))/3.0;gl_FragColor=pow(color,vec4(power));}").textures({texture1:1});i=[];for(var n=0;3>n;n++){var u=a+2*n*Math.PI/3;i.push([t*Math.sin(u)/this.width,t*Math.cos(u)/this.height])}return t=Math.pow(10,e(-1,r,1)),o.call(this,N.lensBlurPrePass,{power:t}),this._.extraTexture.ensureFormat(this._.texture),o.call(this,N.lensBlur0,{delta0:i[0]},this._.texture,this._.extraTexture),o.call(this,N.lensBlur1,{delta0:i[1],delta1:i[2]},this._.extraTexture,this._.extraTexture),o.call(this,N.lensBlur0,{delta0:i[1]}),this._.extraTexture.use(1),o.call(this,N.lensBlur2,{power:1/t,delta0:i[2]}),this}function w(e,t,r,a,i,n){N.tiltShift=N.tiltShift||new G(null,"uniform sampler2D texture;uniform float blurRadius;uniform float gradientRadius;uniform vec2 start;uniform vec2 end;uniform vec2 delta;uniform vec2 texSize;varying vec2 texCoord;"+X+"void main(){vec4 color=vec4(0.0);float total=0.0;float offset=random(vec3(12.9898,78.233,151.7182),0.0);vec2 normal=normalize(vec2(start.y-end.y,end.x-start.x));float radius=smoothstep(0.0,1.0,abs(dot(texCoord*texSize-start,normal))/gradientRadius)*blurRadius;for(float t=-30.0;t<=30.0;t++){float percent=(t+offset-0.5)/30.0;float weight=1.0-abs(percent);vec4 sample=texture2D(texture,texCoord+delta/texSize*percent*radius);sample.rgb*=sample.a;color+=sample*weight;total+=weight;}gl_FragColor=color/total;gl_FragColor.rgb/=gl_FragColor.a+0.00001;}");var u=r-e,l=a-t,s=Math.sqrt(u*u+l*l);return o.call(this,N.tiltShift,{blurRadius:i,gradientRadius:n,start:[e,t],end:[r,a],delta:[u/s,l/s],texSize:[this.width,this.height]}),o.call(this,N.tiltShift,{blurRadius:i,gradientRadius:n,start:[e,t],end:[r,a],delta:[-l/s,u/s],texSize:[this.width,this.height]}),this}function y(e){return N.triangleBlur=N.triangleBlur||new G(null,"uniform sampler2D texture;uniform vec2 delta;varying vec2 texCoord;"+X+"void main(){vec4 color=vec4(0.0);float total=0.0;float offset=random(vec3(12.9898,78.233,151.7182),0.0);for(float t=-30.0;t<=30.0;t++){float percent=(t+offset-0.5)/30.0;float weight=1.0-abs(percent);vec4 sample=texture2D(texture,texCoord+delta*percent);sample.rgb*=sample.a;color+=sample*weight;total+=weight;}gl_FragColor=color/total;gl_FragColor.rgb/=gl_FragColor.a+0.00001;}"),o.call(this,N.triangleBlur,{delta:[e/this.width,0]}),o.call(this,N.triangleBlur,{delta:[0,e/this.height]}),this}function S(e,t,r){return N.zoomBlur=N.zoomBlur||new G(null,"uniform sampler2D texture;uniform vec2 center;uniform float strength;uniform vec2 texSize;varying vec2 texCoord;"+X+"void main(){vec4 color=vec4(0.0);float total=0.0;vec2 toCenter=center-texCoord*texSize;float offset=random(vec3(12.9898,78.233,151.7182),0.0);for(float t=0.0;t<=40.0;t++){float percent=(t+offset)/40.0;float weight=4.0*(percent-percent*percent);vec4 sample=texture2D(texture,texCoord+toCenter*percent*strength/texSize);sample.rgb*=sample.a;color+=sample*weight;total+=weight;}gl_FragColor=color/total;gl_FragColor.rgb/=gl_FragColor.a+0.00001;}"),o.call(this,N.zoomBlur,{center:[e,t],strength:r,texSize:[this.width,this.height]}),this}function D(e,t,r,a){return N.colorHalftone=N.colorHalftone||new G(null,"uniform sampler2D texture;uniform vec2 center;uniform float angle;uniform float scale;uniform vec2 texSize;varying vec2 texCoord;float pattern(float angle){float s=sin(angle),c=cos(angle);vec2 tex=texCoord*texSize-center;vec2 point=vec2(c*tex.x-s*tex.y,s*tex.x+c*tex.y)*scale;return(sin(point.x)*sin(point.y))*4.0;}void main(){vec4 color=texture2D(texture,texCoord);vec3 cmy=1.0-color.rgb;float k=min(cmy.x,min(cmy.y,cmy.z));cmy=(cmy-k)/(1.0-k);cmy=clamp(cmy*10.0-3.0+vec3(pattern(angle+0.26179),pattern(angle+1.30899),pattern(angle)),0.0,1.0);k=clamp(k*10.0-5.0+pattern(angle+0.78539),0.0,1.0);gl_FragColor=vec4(1.0-cmy-k,color.a);}"),o.call(this,N.colorHalftone,{center:[e,t],angle:r,scale:Math.PI/a,texSize:[this.width,this.height]}),this}function M(e,t,r,a){return N.dotScreen=N.dotScreen||new G(null,"uniform sampler2D texture;uniform vec2 center;uniform float angle;uniform float scale;uniform vec2 texSize;varying vec2 texCoord;float pattern(){float s=sin(angle),c=cos(angle);vec2 tex=texCoord*texSize-center;vec2 point=vec2(c*tex.x-s*tex.y,s*tex.x+c*tex.y)*scale;return(sin(point.x)*sin(point.y))*4.0;}void main(){vec4 color=texture2D(texture,texCoord);float average=(color.r+color.g+color.b)/3.0;gl_FragColor=vec4(vec3(average*10.0-5.0+pattern()),color.a);}"),o.call(this,N.dotScreen,{center:[e,t],angle:r,scale:Math.PI/a,texSize:[this.width,this.height]}),this}function O(e){return N.edgeWork1=N.edgeWork1||new G(null,"uniform sampler2D texture;uniform vec2 delta;varying vec2 texCoord;"+X+"void main(){vec2 color=vec2(0.0);vec2 total=vec2(0.0);float offset=random(vec3(12.9898,78.233,151.7182),0.0);for(float t=-30.0;t<=30.0;t++){float percent=(t+offset-0.5)/30.0;float weight=1.0-abs(percent);vec3 sample=texture2D(texture,texCoord+delta*percent).rgb;float average=(sample.r+sample.g+sample.b)/3.0;color.x+=average*weight;total.x+=weight;if(abs(t)<15.0){weight=weight*2.0-1.0;color.y+=average*weight;total.y+=weight;}}gl_FragColor=vec4(color/total,0.0,1.0);}"),N.edgeWork2=N.edgeWork2||new G(null,"uniform sampler2D texture;uniform vec2 delta;varying vec2 texCoord;"+X+"void main(){vec2 color=vec2(0.0);vec2 total=vec2(0.0);float offset=random(vec3(12.9898,78.233,151.7182),0.0);for(float t=-30.0;t<=30.0;t++){float percent=(t+offset-0.5)/30.0;float weight=1.0-abs(percent);vec2 sample=texture2D(texture,texCoord+delta*percent).xy;color.x+=sample.x*weight;total.x+=weight;if(abs(t)<15.0){weight=weight*2.0-1.0;color.y+=sample.y*weight;total.y+=weight;}}float c=clamp(10000.0*(color.y/total.y-color.x/total.x)+0.5,0.0,1.0);gl_FragColor=vec4(c,c,c,1.0);}"),o.call(this,N.edgeWork1,{delta:[e/this.width,0]}),o.call(this,N.edgeWork2,{delta:[0,e/this.height]}),this}function I(e,t,r){return N.hexagonalPixelate=N.hexagonalPixelate||new G(null,"uniform sampler2D texture;uniform vec2 center;uniform float scale;uniform vec2 texSize;varying vec2 texCoord;void main(){vec2 tex=(texCoord*texSize-center)/scale;tex.y/=0.866025404;tex.x-=tex.y*0.5;vec2 a;if(tex.x+tex.y-floor(tex.x)-floor(tex.y)<1.0)a=vec2(floor(tex.x),floor(tex.y));else a=vec2(ceil(tex.x),ceil(tex.y));vec2 b=vec2(ceil(tex.x),floor(tex.y));vec2 c=vec2(floor(tex.x),ceil(tex.y));vec3 TEX=vec3(tex.x,tex.y,1.0-tex.x-tex.y);vec3 A=vec3(a.x,a.y,1.0-a.x-a.y);vec3 B=vec3(b.x,b.y,1.0-b.x-b.y);vec3 C=vec3(c.x,c.y,1.0-c.x-c.y);float alen=length(TEX-A);float blen=length(TEX-B);float clen=length(TEX-C);vec2 choice;if(alen<blen){if(alen<clen)choice=a;else choice=c;}else{if(blen<clen)choice=b;else choice=c;}choice.x+=choice.y*0.5;choice.y*=0.866025404;choice*=scale/texSize;gl_FragColor=texture2D(texture,choice+center/texSize);}"),o.call(this,N.hexagonalPixelate,{center:[e,t],scale:r,texSize:[this.width,this.height]}),this}function C(e){return N.ink=N.ink||new G(null,"uniform sampler2D texture;uniform float strength;uniform vec2 texSize;varying vec2 texCoord;void main(){vec2 dx=vec2(1.0/texSize.x,0.0);vec2 dy=vec2(0.0,1.0/texSize.y);vec4 color=texture2D(texture,texCoord);float bigTotal=0.0;float smallTotal=0.0;vec3 bigAverage=vec3(0.0);vec3 smallAverage=vec3(0.0);for(float x=-2.0;x<=2.0;x+=1.0){for(float y=-2.0;y<=2.0;y+=1.0){vec3 sample=texture2D(texture,texCoord+dx*x+dy*y).rgb;bigAverage+=sample;bigTotal+=1.0;if(abs(x)+abs(y)<2.0){smallAverage+=sample;smallTotal+=1.0;}}}vec3 edge=max(vec3(0.0),bigAverage/bigTotal-smallAverage/smallTotal);gl_FragColor=vec4(color.rgb-dot(edge,edge)*strength*100000.0,color.a);}"),o.call(this,N.ink,{strength:e*e*e*e*e,texSize:[this.width,this.height]}),this}function L(t,r,a,i){return N.bulgePinch=N.bulgePinch||E("uniform float radius;uniform float strength;uniform vec2 center;","coord-=center;float distance=length(coord);if(distance<radius){float percent=distance/radius;if(strength>0.0){coord*=mix(1.0,smoothstep(0.0,radius/distance,percent),strength*0.75);}else{coord*=mix(1.0,pow(percent,1.0+strength*0.75)*radius/distance,1.0-percent);}}coord+=center;"),o.call(this,N.bulgePinch,{radius:a,strength:e(-1,i,1),center:[t,r],texSize:[this.width,this.height]}),this}function U(e,t,r){if(N.matrixWarp=N.matrixWarp||E("uniform mat3 matrix;uniform bool useTextureSpace;","if(useTextureSpace)coord=coord/texSize*2.0-1.0;vec3 warp=matrix*vec3(coord,1.0);coord=warp.xy/warp.z;if(useTextureSpace)coord=(coord*0.5+0.5)*texSize;"),4==(e=Array.prototype.concat.apply([],e)).length)e=[e[0],e[1],0,e[2],e[3],0,0,0,1];else if(9!=e.length)throw"can only warp with 2x2 or 3x3 matrix";return o.call(this,N.matrixWarp,{matrix:t?f(e):e,texSize:[this.width,this.height],useTextureSpace:0|r}),this}function B(e,t){var r=d.apply(null,t),a=d.apply(null,e);r=f(r);return this.matrixWarp([r[0]*a[0]+r[1]*a[3]+r[2]*a[6],r[0]*a[1]+r[1]*a[4]+r[2]*a[7],r[0]*a[2]+r[1]*a[5]+r[2]*a[8],r[3]*a[0]+r[4]*a[3]+r[5]*a[6],r[3]*a[1]+r[4]*a[4]+r[5]*a[7],r[3]*a[2]+r[4]*a[5]+r[5]*a[8],r[6]*a[0]+r[7]*a[3]+r[8]*a[6],r[6]*a[1]+r[7]*a[4]+r[8]*a[7],r[6]*a[2]+r[7]*a[5]+r[8]*a[8]])}function P(e,t,r,a){return N.swirl=N.swirl||E("uniform float radius;uniform float angle;uniform vec2 center;","coord-=center;float distance=length(coord);if(distance<radius){float percent=(radius-distance)/radius;float theta=percent*percent*angle;float s=sin(theta);float c=cos(theta);coord=vec2(coord.x*c-coord.y*s,coord.x*s+coord.y*c);}coord+=center;"),o.call(this,N.swirl,{radius:r,center:[e,t],angle:a,texSize:[this.width,this.height]}),this}var N,H={};!function(){function e(){}try{var t=document.createElement("canvas").getContext("experimental-webgl")}catch(e){}if(t&&-1===t.getSupportedExtensions().indexOf("OES_texture_float_linear")&&function(e){if(!e.getExtension("OES_texture_float"))return!1;var t=e.createFramebuffer(),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0),t=e.createTexture(),e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,2,2,0,e.RGBA,e.FLOAT,new Float32Array([2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])),r=e.createProgram();var a=e.createShader(e.VERTEX_SHADER),i=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(a,"attribute vec2 vertex;void main(){gl_Position=vec4(vertex,0.0,1.0);}"),e.shaderSource(i,"uniform sampler2D texture;void main(){gl_FragColor=texture2D(texture,vec2(0.5));}"),e.compileShader(a),e.compileShader(i),e.attachShader(r,a),e.attachShader(r,i),e.linkProgram(r),a=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0]),e.STREAM_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0),a=new Uint8Array(4),e.useProgram(r),e.viewport(0,0,1,1),e.bindTexture(e.TEXTURE_2D,t),e.drawArrays(e.POINTS,0,1),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,a),127===a[0]||128===a[0]}(t)){var r=WebGLRenderingContext.prototype.getExtension,a=WebGLRenderingContext.prototype.getSupportedExtensions;WebGLRenderingContext.prototype.getExtension=function(t){return"OES_texture_float_linear"===t?(void 0===this.$OES_texture_float_linear$&&Object.defineProperty(this,"$OES_texture_float_linear$",{enumerable:!1,configurable:!1,writable:!1,value:new e}),t=this.$OES_texture_float_linear$):t=r.call(this,t),t},WebGLRenderingContext.prototype.getSupportedExtensions=function(){var e=a.call(this);return-1===e.indexOf("OES_texture_float_linear")&&e.push("OES_texture_float_linear"),e}}}(),H.canvas=function(){var e=document.createElement("canvas");try{N=e.getContext("experimental-webgl",{premultipliedAlpha:!1})}catch(e){N=null}if(!N)throw"This browser does not support WebGL";return e._={gl:N,isInitialized:!1,texture:null,spareTexture:null,flippedShader:null},e.texture=c(r),e.draw=c(i),e.update=c(n),e.replace=c(u),e.contents=c(l),e.getPixelArray=c(s),e.brightnessContrast=c(m),e.hexagonalPixelate=c(I),e.hueSaturation=c(x),e.colorHalftone=c(D),e.triangleBlur=c(y),e.unsharpMask=c(R),e.perspective=c(B),e.matrixWarp=c(U),e.bulgePinch=c(L),e.tiltShift=c(w),e.dotScreen=c(M),e.edgeWork=c(O),e.lensBlur=c(A),e.zoomBlur=c(S),e.noise=c(T),e.denoise=c(p),e.curves=c(g),e.swirl=c(P),e.ink=c(C),e.vignette=c(_),e.vibrance=c(F),e.sepia=c(b),e},H.splineInterpolate=h;var G=function(){function e(e,t){var r=N.createShader(e);if(N.shaderSource(r,t),N.compileShader(r),!N.getShaderParameter(r,N.COMPILE_STATUS))throw"compile error: "+N.getShaderInfoLog(r);return r}function t(t,i){if(this.texCoordAttribute=this.vertexAttribute=null,this.program=N.createProgram(),t=t||r,i="precision highp float;"+(i=i||a),N.attachShader(this.program,e(N.VERTEX_SHADER,t)),N.attachShader(this.program,e(N.FRAGMENT_SHADER,i)),N.linkProgram(this.program),!N.getProgramParameter(this.program,N.LINK_STATUS))throw"link error: "+N.getProgramInfoLog(this.program)}var r="attribute vec2 vertex;attribute vec2 _texCoord;varying vec2 texCoord;void main(){texCoord=_texCoord;gl_Position=vec4(vertex*2.0-1.0,0.0,1.0);}",a="uniform sampler2D texture;varying vec2 texCoord;void main(){gl_FragColor=texture2D(texture,texCoord);}";return t.prototype.destroy=function(){N.deleteProgram(this.program),this.program=null},t.prototype.uniforms=function(e){for(var t in N.useProgram(this.program),e)if(e.hasOwnProperty(t)){var r=N.getUniformLocation(this.program,t);if(null!==r){var a=e[t];if("[object Array]"==Object.prototype.toString.call(a))switch(a.length){case 1:N.uniform1fv(r,new Float32Array(a));break;case 2:N.uniform2fv(r,new Float32Array(a));break;case 3:N.uniform3fv(r,new Float32Array(a));break;case 4:N.uniform4fv(r,new Float32Array(a));break;case 9:N.uniformMatrix3fv(r,!1,new Float32Array(a));break;case 16:N.uniformMatrix4fv(r,!1,new Float32Array(a));break;default:throw"dont't know how to load uniform \""+t+'" of length '+a.length}else{if("[object Number]"!=Object.prototype.toString.call(a))throw'attempted to set uniform "'+t+'" to invalid value '+(a||"undefined").toString();N.uniform1f(r,a)}}}return this},t.prototype.textures=function(e){for(var t in N.useProgram(this.program),e)e.hasOwnProperty(t)&&N.uniform1i(N.getUniformLocation(this.program,t),e[t]);return this},t.prototype.drawRect=function(e,t,r,a){var i=N.getParameter(N.VIEWPORT);t=void 0!==t?(t-i[1])/i[3]:0,e=void 0!==e?(e-i[0])/i[2]:0,r=void 0!==r?(r-i[0])/i[2]:1,a=void 0!==a?(a-i[1])/i[3]:1,null==N.vertexBuffer&&(N.vertexBuffer=N.createBuffer()),N.bindBuffer(N.ARRAY_BUFFER,N.vertexBuffer),N.bufferData(N.ARRAY_BUFFER,new Float32Array([e,t,e,a,r,t,r,a]),N.STATIC_DRAW),null==N.texCoordBuffer&&(N.texCoordBuffer=N.createBuffer(),N.bindBuffer(N.ARRAY_BUFFER,N.texCoordBuffer),N.bufferData(N.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),N.STATIC_DRAW)),null==this.vertexAttribute&&(this.vertexAttribute=N.getAttribLocation(this.program,"vertex"),N.enableVertexAttribArray(this.vertexAttribute)),null==this.texCoordAttribute&&(this.texCoordAttribute=N.getAttribLocation(this.program,"_texCoord"),N.enableVertexAttribArray(this.texCoordAttribute)),N.useProgram(this.program),N.bindBuffer(N.ARRAY_BUFFER,N.vertexBuffer),N.vertexAttribPointer(this.vertexAttribute,2,N.FLOAT,!1,0,0),N.bindBuffer(N.ARRAY_BUFFER,N.texCoordBuffer),N.vertexAttribPointer(this.texCoordAttribute,2,N.FLOAT,!1,0,0),N.drawArrays(N.TRIANGLE_STRIP,0,4)},t.getDefaultShader=function(){return N.defaultShader=N.defaultShader||new t,N.defaultShader},t}();v.prototype.interpolate=function(e){for(var t=0,r=this.ya.length-1;1<r-t;){var a=r+t>>1;this.xa[a]>e?r=a:t=a}a=this.xa[r]-this.xa[t];var i=(this.xa[r]-e)/a;return e=(e-this.xa[t])/a,i*this.ya[t]+e*this.ya[r]+((i*i*i-i)*this.y2[t]+(e*e*e-e)*this.y2[r])*a*a/6};var z=function(){function e(e,t,r,a){this.gl=N,this.id=N.createTexture(),this.width=e,this.height=t,this.format=r,this.type=a,N.bindTexture(N.TEXTURE_2D,this.id),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MAG_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),e&&t&&N.texImage2D(N.TEXTURE_2D,0,this.format,e,t,0,this.format,this.type,null)}function t(e){return null==r&&(r=document.createElement("canvas")),r.width=e.width,r.height=e.height,(e=r.getContext("2d")).clearRect(0,0,r.width,r.height),e}e.fromElement=function(t){var r=new e(0,0,N.RGBA,N.UNSIGNED_BYTE);return r.loadContentsOf(t),r},e.prototype.loadContentsOf=function(e){this.width=e.width||e.videoWidth,this.height=e.height||e.videoHeight,N.bindTexture(N.TEXTURE_2D,this.id),N.texImage2D(N.TEXTURE_2D,0,this.format,this.format,this.type,e)},e.prototype.initFromBytes=function(e,t,r){this.width=e,this.height=t,this.format=N.RGBA,this.type=N.UNSIGNED_BYTE,N.bindTexture(N.TEXTURE_2D,this.id),N.texImage2D(N.TEXTURE_2D,0,N.RGBA,e,t,0,N.RGBA,this.type,new Uint8Array(r))},e.prototype.destroy=function(){N.deleteTexture(this.id),this.id=null},e.prototype.use=function(e){N.activeTexture(N.TEXTURE0+(e||0)),N.bindTexture(N.TEXTURE_2D,this.id)},e.prototype.unuse=function(e){N.activeTexture(N.TEXTURE0+(e||0)),N.bindTexture(N.TEXTURE_2D,null)},e.prototype.ensureFormat=function(e,t,r,a){if(1==arguments.length){var i=arguments[0];e=i.width,t=i.height,r=i.format,a=i.type}e==this.width&&t==this.height&&r==this.format&&a==this.type||(this.width=e,this.height=t,this.format=r,this.type=a,N.bindTexture(N.TEXTURE_2D,this.id),N.texImage2D(N.TEXTURE_2D,0,this.format,e,t,0,this.format,this.type,null))},e.prototype.drawTo=function(e){if(N.framebuffer=N.framebuffer||N.createFramebuffer(),N.bindFramebuffer(N.FRAMEBUFFER,N.framebuffer),N.framebufferTexture2D(N.FRAMEBUFFER,N.COLOR_ATTACHMENT0,N.TEXTURE_2D,this.id,0),N.checkFramebufferStatus(N.FRAMEBUFFER)!==N.FRAMEBUFFER_COMPLETE)throw Error("incomplete framebuffer");N.viewport(0,0,this.width,this.height),e(),N.bindFramebuffer(N.FRAMEBUFFER,null)};var r=null;return e.prototype.fillUsingCanvas=function(e){return e(t(this)),this.format=N.RGBA,this.type=N.UNSIGNED_BYTE,N.bindTexture(N.TEXTURE_2D,this.id),N.texImage2D(N.TEXTURE_2D,0,N.RGBA,N.RGBA,N.UNSIGNED_BYTE,r),this},e.prototype.toImage=function(e){this.use(),G.getDefaultShader().drawRect();var a=4*this.width*this.height,i=new Uint8Array(a),n=t(this),o=n.createImageData(this.width,this.height);N.readPixels(0,0,this.width,this.height,N.RGBA,N.UNSIGNED_BYTE,i);for(var u=0;u<a;u++)o.data[u]=i[u];n.putImageData(o,0,0),e.src=r.toDataURL()},e.prototype.swapWith=function(e){var t;t=e.id,e.id=this.id,this.id=t,t=e.width,e.width=this.width,this.width=t,t=e.height,e.height=this.height,this.height=t,t=e.format,e.format=this.format,this.format=t},e}(),X="float random(vec3 scale,float seed){return fract(sin(dot(gl_FragCoord.xyz+seed,scale))*43758.5453+seed);}";return H}(),_states={idle:0,loading:1,dragging:2},_state=_states.idle,_dP=new window.THREE.Vector3,_x0=-1,_y0=-1,_scenes=null,_boundFunction=null;function updateMeshPosition(e,t){var r=new window.THREE.Vector3,a=new window.THREE.Vector3,i=new window.THREE.Vector3;if(_state===_states.dragging){var n=!(!t.touches||!t.touches.length),o=n?t.touches[0].clientX:t.clientX,u=n?t.touches[0].clientY:t.clientY,l=o-_x0,s=u-_y0;_x0=o,_y0=u;var c=-l/e.offsetWidth,d=-s/e.offsetHeight,f=1===_scenes.length?_scenes[0]:_scenes.find((function(t){if(!t.parent.visible)return!1;r.set(-o/e.offsetWidth*2+1,-u/e.offsetHeight*2+1,.5);var a=new window.THREE.Raycaster;return a.setFromCamera(r,window.THREECAMERA),a.intersectObjects(t.children).length>0}));if(f){if(i.set(c,d,1),a.copy(i),!window.THREECAMERA)throw new Error("Cannot find the THREE.js camera. Please check that window.THREECAMERA is the default scene camera");a.unproject(window.THREECAMERA),a.sub(window.THREECAMERA.position),a.normalize();var v=-1/a.z;_dP.copy(a).multiplyScalar(v),_dP.setZ(0);var E=new window.THREE.Quaternion,m=new window.THREE.Euler;m.setFromQuaternion(E),_dP.applyEuler(f.getWorldQuaternion(m)),_dP.multiplyScalar(10),f.position.add(_dP)}}}function setMousePosition0(e){var t=!(!e.touches||!e.touches.length);t&&e.touches.length>1||(_x0=t?e.touches[0].clientX:e.clientX,_y0=t?e.touches[0].clientY:e.clientY)}function mouseDown(e){setMousePosition0(e),_state=_states.dragging}function mouseUp(){_state=_states.idle}function addDragEventListener(e,t,r){_scenes=Array.isArray(e)?e:[e];var a=document.getElementById(void 0===t?"jeeFaceFilterCanvas":t);_state=_states.idle,_dP=new window.THREE.Vector3,_x0=void 0,_y0=void 0,r?(a.removeEventListener("mousemove",_boundFunction,!0),a.removeEventListener("touchmove",_boundFunction,!0),a.removeEventListener("mousedown",mouseDown),a.removeEventListener("touchstart",mouseDown),a.removeEventListener("mouseup",mouseUp),a.removeEventListener("touchend",mouseUp),a.removeEventListener("mouseout",mouseUp),a.removeEventListener("touchcancel",mouseUp)):(_boundFunction=updateMeshPosition.bind(this,a),a.addEventListener("mousemove",_boundFunction,!0),a.addEventListener("touchmove",_boundFunction,!0),a.addEventListener("mousedown",mouseDown),a.addEventListener("touchstart",mouseDown),a.addEventListener("mouseup",mouseUp),a.addEventListener("touchend",mouseUp),a.addEventListener("mouseout",mouseUp),a.addEventListener("touchcancel",mouseUp))}(Filters=window.Filters||{}).dog={BASE_URL:"./filters/jeelizFaceFilter/demos/threejs/dog_face",THREECAMERA:null,ISDETECTED:!1,TONGUEMESH:null,NOSEMESH:null,EARMESH:null,DOGOBJ3D:null,FRAMEOBJ3D:null,ISOVERTHRESHOLD:!1,ISUNDERTRESHOLD:!0,ISLOADED:!1,MIXER:null,ACTION:null,ISANIMATING:!1,ISOPAQUE:!1,ISTONGUEOUT:!1,ISANIMATIONOVER:!1,createMat2d:function(e,t){return new THREE.RawShaderMaterial({depthWrite:!1,depthTest:!1,transparent:t,vertexShader:"attribute vec2 position;\n      varying vec2 vUV;\n      void main(void){\n        gl_Position=vec4(position, 0., 1.);\n        vUV=0.5+0.5*position;\n      }",fragmentShader:"precision lowp float;\n      uniform sampler2D samplerVideo;\n      varying vec2 vUV;\n      void main(void){\n        gl_FragColor=texture2D(samplerVideo, vUV);\n      }",uniforms:{samplerVideo:{value:e}}})},applyFilter:function(){var e;try{e=fx.canvas()}catch(e){return}var t=new Image(512,512);t.src=Filters.dog.BASE_URL+"/images/texture_pink.jpg",t.onload=function(){var r=e.texture(t);e.draw(r).vignette(.5,.6).update();var a=document.createElement("canvas");a.width=512,a.height=512;var i=a.getContext("2d");i.globalAlpha=.2,i.drawImage(e,0,0,512,512)}},initThreeScene:function(e){var t=THREE.JeelizHelper.init(e),r=new THREE.LoadingManager;new THREE.BufferGeometryLoader(r).load(Filters.dog.BASE_URL+"/models/dog/dog_ears.json",(function(e){var t=new THREE.FlexMaterial({map:(new THREE.TextureLoader).load(Filters.dog.BASE_URL+"/models/dog/texture_ears.jpg"),flexMap:(new THREE.TextureLoader).load(Filters.dog.BASE_URL+"/models/dog/flex_ears_256.jpg"),alphaMap:(new THREE.TextureLoader).load(Filters.dog.BASE_URL+"/models/dog/alpha_ears_256.jpg"),transparent:!0,opacity:1,bumpMap:(new THREE.TextureLoader).load(Filters.dog.BASE_URL+"/models/dog/normal_ears.jpg"),bumpScale:.0075,shininess:1.5,specular:16777215});Filters.dog.EARMESH=new THREE.Mesh(e,t),Filters.dog.EARMESH.scale.multiplyScalar(.025),Filters.dog.EARMESH.position.setY(-.3),Filters.dog.EARMESH.frustumCulled=!1,Filters.dog.EARMESH.renderOrder=1e4,Filters.dog.EARMESH.material.opacity.value=1})),new THREE.BufferGeometryLoader(r).load(Filters.dog.BASE_URL+"/models/dog/dog_nose.json",(function(e){var t=new THREE.MeshPhongMaterial({map:(new THREE.TextureLoader).load(Filters.dog.BASE_URL+"/models/dog/texture_nose.jpg"),shininess:1.5,specular:16777215,bumpMap:(new THREE.TextureLoader).load(Filters.dog.BASE_URL+"/models/dog/normal_nose.jpg"),bumpScale:.005});Filters.dog.NOSEMESH=new THREE.Mesh(e,t),Filters.dog.NOSEMESH.scale.multiplyScalar(.018),Filters.dog.NOSEMESH.position.setY(-.05),Filters.dog.NOSEMESH.position.setZ(.15),Filters.dog.NOSEMESH.frustumCulled=!1,Filters.dog.NOSEMESH.renderOrder=1e4})),new THREE.JSONLoader(r).load(Filters.dog.BASE_URL+"/models/dog/dog_tongue.json",(function(e){e.computeMorphNormals();var t=new THREE.FlexMaterial({map:(new THREE.TextureLoader).load(Filters.dog.BASE_URL+"/models/dog/dog_tongue.jpg"),flexMap:(new THREE.TextureLoader).load(Filters.dog.BASE_URL+"/models/dog/flex_tongue_256.png"),alphaMap:(new THREE.TextureLoader).load(Filters.dog.BASE_URL+"/models/dog/tongue_alpha_256.jpg"),transparent:!0,morphTargets:!0,opacity:1});if(Filters.dog.TONGUEMESH=new THREE.Mesh(e,t),Filters.dog.TONGUEMESH.material.opacity.value=0,Filters.dog.TONGUEMESH.scale.multiplyScalar(2),Filters.dog.TONGUEMESH.position.setY(-.28),Filters.dog.TONGUEMESH.frustumCulled=!1,Filters.dog.TONGUEMESH.visible=!1,!Filters.dog.MIXER){Filters.dog.MIXER=new THREE.AnimationMixer(Filters.dog.TONGUEMESH);var r=Filters.dog.TONGUEMESH.geometry.animations[0];Filters.dog.ACTION=Filters.dog.MIXER.clipAction(r),Filters.dog.ACTION.noLoop=!0,Filters.dog.ACTION.play()}})),r.onLoad=function(){Filters.dog.DOGOBJ3D.add(Filters.dog.EARMESH),Filters.dog.DOGOBJ3D.add(Filters.dog.NOSEMESH),Filters.dog.DOGOBJ3D.add(Filters.dog.TONGUEMESH),t.faceObject.add(Filters.dog.DOGOBJ3D),Filters.dog.ISLOADED=!0};var a=new THREE.AmbientLight(16777215,.8);t.scene.add(a);var i=new THREE.DirectionalLight(16777215,.5);i.position.set(100,1e3,1e3),t.scene.add(i),Filters.dog.THREECAMERA=THREE.JeelizHelper.create_camera(),t.scene.add(Filters.dog.FRAMEOBJ3D),Filters.dog.applyFilter()},animateTongue:function(e,t){e.visible=!0,t?(Filters.dog.ACTION.timescale=-1,Filters.dog.ACTION.paused=!1,setTimeout((function(){Filters.dog.ACTION.paused=!0,Filters.dog.ISOPAQUE=!1,Filters.dog.ISTONGUEOUT=!1,Filters.dog.ISANIMATING=!1,Filters.dog.ISANIMATIONOVER=!0,new TWEEN.Tween(e.material.opacity).to({value:0},150).start()}),150)):(Filters.dog.ACTION.timescale=1,Filters.dog.ACTION.reset(),Filters.dog.ACTION.paused=!1,new TWEEN.Tween(e.material.opacity).to({value:1},100).onComplete((function(){Filters.dog.ISOPAQUE=!0,setTimeout((function(){Filters.dog.ACTION.paused=!0,Filters.dog.ISANIMATING=!1,Filters.dog.ISTONGUEOUT=!0,Filters.dog.ISANIMATIONOVER=!0}),150)})).start())},init:function(e){Filters.dog.DOGOBJ3D=new THREE.Object3D,Filters.dog.FRAMEOBJ3D=new THREE.Object3D,JeelizResizer.size_canvas({canvasId:"filter-canvas",callback:function(t,r){Filters.dog.initFaceFilter(r,e)}})},initFaceFilter:function(e,t){JEEFACEFILTERAPI.init({canvasId:"filter-canvas",NNCpath:"./filters/jeelizFaceFilter/dist/",videoSettings:e,callbackReady:function(e,r){e||(Filters.dog.initThreeScene(r),t&&setTimeout(t,100))},callbackTrack:function(e){if(Filters.dog.ISDETECTED=THREE.JeelizHelper.get_isDetected(),Filters.dog.ISDETECTED){var t=new THREE.Quaternion,r=new THREE.Euler;r.setFromQuaternion(t),Filters.dog.EARMESH&&Filters.dog.EARMESH.material.set_amortized&&Filters.dog.EARMESH.material.set_amortized(Filters.dog.EARMESH.getWorldPosition(new THREE.Vector3(0,0,0)),Filters.dog.EARMESH.getWorldScale(new THREE.Vector3(0,0,0)),Filters.dog.EARMESH.getWorldQuaternion(r),!1,.1),Filters.dog.TONGUEMESH&&Filters.dog.TONGUEMESH.material.set_amortized&&Filters.dog.TONGUEMESH.material.set_amortized(Filters.dog.TONGUEMESH.getWorldPosition(new THREE.Vector3(0,0,0)),Filters.dog.TONGUEMESH.getWorldScale(new THREE.Vector3(0,0,0)),Filters.dog.TONGUEMESH.getWorldQuaternion(r),!1,.3),e.expressions[0]>=.85&&!Filters.dog.ISOVERTHRESHOLD&&(Filters.dog.ISOVERTHRESHOLD=!0,Filters.dog.ISUNDERTRESHOLD=!1,Filters.dog.ISANIMATIONOVER=!1),e.expressions[0]<=.1&&!Filters.dog.ISUNDERTRESHOLD&&(Filters.dog.ISOVERTHRESHOLD=!1,Filters.dog.ISUNDERTRESHOLD=!0,Filters.dog.ISANIMATIONOVER=!1),Filters.dog.ISLOADED&&Filters.dog.ISOVERTHRESHOLD&&!Filters.dog.ISANIMATING&&!Filters.dog.ISANIMATIONOVER&&(Filters.dog.ISTONGUEOUT?(Filters.dog.ISANIMATING=!0,Filters.dog.animateTongue(Filters.dog.TONGUEMESH,!0)):(Filters.dog.ISANIMATING=!0,Filters.dog.animateTongue(Filters.dog.TONGUEMESH)))}TWEEN.update(),Filters.dog.ISOPAQUE&&Filters.dog.MIXER.update(.16),THREE.JeelizHelper.render(e,Filters.dog.THREECAMERA)}})}},(Filters=window.Filters||{}).bees={BASE_URL:"./filters/jeelizFaceFilter/demos/threejs/miel_pops",SETTINGS:{numberBees:8},THREECAMERA:null,GLASSESOBJ3D:null,ACTIONS:[],MIXERS:[],ISANIMATED:!1,BEEMESH:null,BEEOBJ3D:null,initThreeScene:function(e){var t=THREE.JeelizHelper.init(e),r=null,a=null,i=null,n=null,o=new THREE.LoadingManager;new THREE.BufferGeometryLoader(o).load(Filters.bees.BASE_URL+"/models/glasses/frame.json",(function(e){var t=new THREE.MeshPhongMaterial({color:0,shininess:2,specular:16777215,transparent:!0});(r=new THREE.Mesh(e,t)).scale.multiplyScalar(.0067),r.frustumCulled=!1,r.renderOrder=1e4})),new THREE.BufferGeometryLoader(o).load(Filters.bees.BASE_URL+"/models/glasses/lenses.json",(function(e){var t=new THREE.MeshBasicMaterial({map:(new THREE.TextureLoader).load(Filters.bees.BASE_URL+"/models/glasses/texture_mp.jpg")});(a=new THREE.Mesh(e,t)).scale.multiplyScalar(.0067),a.frustumCulled=!1,a.renderOrder=1e4})),new THREE.BufferGeometryLoader(o).load(Filters.bees.BASE_URL+"/models/glasses/branches.json",(function(e){var t=new THREE.MeshBasicMaterial({alphaMap:(new THREE.TextureLoader).load(Filters.bees.BASE_URL+"/models/glasses/alpha_branches.jpg"),map:(new THREE.TextureLoader).load(Filters.bees.BASE_URL+"/models/glasses/textureBlack.jpg"),transparent:!0});(i=new THREE.Mesh(e,t)).scale.multiplyScalar(.0067),i.frustumCulled=!1,i.renderOrder=1e4})),new THREE.BufferGeometryLoader(o).load(Filters.bees.BASE_URL+"/models/glasses/deco.json",(function(e){var t=new THREE.MeshBasicMaterial({color:16777215});(n=new THREE.Mesh(e,t)).scale.multiplyScalar(.0067),n.frustumCulled=!1,n.renderOrder=1e4})),o.onLoad=function(){Filters.bees.GLASSESOBJ3D.add(i,r,a,n),Filters.bees.GLASSESOBJ3D.scale.multiplyScalar(1.1),Filters.bees.GLASSESOBJ3D.position.setY(.05),Filters.bees.GLASSESOBJ3D.position.setZ(.25),t.faceObject.add(Filters.bees.GLASSESOBJ3D)},(new THREE.JSONLoader).load(Filters.bees.BASE_URL+"/models/bee/bee.json",(function(e){var r=new THREE.MeshLambertMaterial({map:(new THREE.TextureLoader).load(Filters.bees.BASE_URL+"/models/bee/texture_bee.jpg"),transparent:!0,morphTargets:!0});Filters.bees.BEEMESH=new THREE.Mesh(e,r),Filters.bees.BEEOBJ3D=new THREE.Object3D;for(var a=1;a<Filters.bees.SETTINGS.numberBees;a++){var i=a%2==0?1:-1,n=Filters.bees.BEEMESH.clone(),o=1.5*Math.random()-.75,u=2*Math.random()-1+1,l=.5*Math.random()-.25;n.position.set(o,u,l),n.scale.multiplyScalar(.1),Filters.bees.animateFlyBees(n,i*(.005*(a+1)+.01),i);var s=new THREE.Object3D;if(s.add(n),!Filters.bees.ISANIMATED){var c=new THREE.AnimationMixer(n),d=n.geometry.animations[0],f=c.clipAction(d);Filters.bees.ACTIONS.push(f),Filters.bees.MIXERS.push(c)}Filters.bees.BEEOBJ3D.add(s)}Filters.bees.ACTIONS.forEach((function(e,t){setTimeout((function(){e.play()}),33*t)})),Filters.bees.ISANIMATED=!0,t.faceObject.add(Filters.bees.BEEOBJ3D)})),Filters.bees.THREECAMERA=THREE.JeelizHelper.create_camera();var u=new THREE.AmbientLight(16777215,1);t.scene.add(u);var l=new THREE.DirectionalLight(16777215);l.position.set(100,1e3,100),t.scene.add(l)},animateFlyBees:function(e,t,r){setInterval((function(){var a=e.position.x,i=e.position.z,n=e.position.y;e.position.set(a*Math.cos(t)+i*Math.sin(t),.96*(n*Math.cos(t)+a*Math.sin(t))+.05,i*Math.cos(t)-a*Math.sin(t)),e.rotation.set(-(a*Math.cos(t)+i*Math.sin(t))*r,-(n*Math.cos(t)+i*Math.sin(t))*r,-(i*Math.cos(t)-a*Math.sin(t))*r)}),16)},init:function(e){Filters.bees.GLASSESOBJ3D=new THREE.Object3D,JeelizResizer.size_canvas({canvasId:"filter-canvas",callback:function(t,r){Filters.bees.initFaceFilter(r,e)}})},initFaceFilter:function(e,t){JEEFACEFILTERAPI.init({canvasId:"filter-canvas",NNCpath:"./filters/jeelizFaceFilter/dist/",videoSettings:e,callbackReady:function(e,r){e||(Filters.bees.initThreeScene(r),t&&setTimeout(t,100))},callbackTrack:function(e){THREE.JeelizHelper.render(e,Filters.bees.THREECAMERA),Filters.bees.MIXERS.length>1&&Filters.bees.MIXERS.forEach((function(e){e.update(.16)}))}})}},(Filters=window.Filters||{}).halloween={BASE_URL:"./filters/jeelizFaceFilter/demos/threejs/halloween_spider",THREECAMERA:null,ISDETECTED:!1,MIXERS:[],ACTIONS:[],MASKOBJ3D:null,isAnimating:!1,initThreeScene:function(e){var t,r,a=THREE.JeelizHelper.init(e),i=new THREE.LoadingManager;new THREE.JSONLoader(i).load(Filters.halloween.BASE_URL+"/models/small_spider/small_spider.json",(function(e){var r=new THREE.MeshBasicMaterial({map:(new THREE.TextureLoader).load(Filters.halloween.BASE_URL+"/models/small_spider/diffuse_spider.jpg"),morphTargets:!0});(t=new THREE.Mesh(e,r)).frustumCulled=!1,t.position.y-=.2;var a=new THREE.AnimationMixer(t),i=t.geometry.animations[0],n=a.clipAction(i);Filters.halloween.MIXERS.push(a),Filters.halloween.ACTIONS.push(n)})),new THREE.JSONLoader(i).load(Filters.halloween.BASE_URL+"/models/big_spider/big_spider.json",(function(e){var t=new THREE.MeshBasicMaterial({map:(new THREE.TextureLoader).load(Filters.halloween.BASE_URL+"/models/big_spider/diffuse_spider.jpg"),morphTargets:!0});(r=new THREE.Mesh(e,t)).frustumCulled=!1;var a=new THREE.AnimationMixer(r),i=r.geometry.animations[0],n=a.clipAction(i);Filters.halloween.MIXERS.push(a),Filters.halloween.ACTIONS.push(n)}));var n=null;new THREE.BufferGeometryLoader(i).load(Filters.halloween.BASE_URL+"/models/face/face.json",(function(e){var t=new THREE.ShaderMaterial({vertexShader:"varying vec2 vUVvideo;\n      varying float vY, vNormalDotZ;\n      const float THETAHEAD=0.25;\n      void main() {\n        vec4 mvPosition = modelViewMatrix * vec4( position, 1.0);\n        vec4 projectedPosition = projectionMatrix * mvPosition;\n        gl_Position = projectedPosition;\n        \n        // compute UV coordinates on the video texture:\n        vec4 mvPosition0 = modelViewMatrix * vec4( position, 1.0 );\n        vec4 projectedPosition0 = projectionMatrix * mvPosition0;\n        vUVvideo = vec2(0.5,0.5)+0.5*projectedPosition0.xy/projectedPosition0.w;\n        vY = position.y*cos(THETAHEAD)-position.z*sin(THETAHEAD);\n        vec3 normalView = vec3(modelViewMatrix * vec4(normal,0.));\n        vNormalDotZ = pow(abs(normalView.z), 1.5);\n      }",fragmentShader:"precision lowp float;\n      uniform sampler2D samplerVideo;\n      varying vec2 vUVvideo;\n      varying float vY, vNormalDotZ;\n      void main() {\n        vec3 videoColor = texture2D(samplerVideo, vUVvideo).rgb;\n        float darkenCoeff = smoothstep(-0.15, 0.05, vY);\n        float borderCoeff = smoothstep(0.0, 0.55, vNormalDotZ);\n        gl_FragColor = vec4(videoColor, 1 );\n        // gl_FragColor=vec4(borderCoeff, 0., 0., 1.);\n        // gl_FragColor=vec4(darkenCoeff, 0., 0., 1.);\n      }",transparent:!0,flatShading:!1,uniforms:{samplerVideo:{value:THREE.JeelizHelper.get_threeVideoTexture()}}});n=new THREE.Mesh(e,t)})),i.onLoad=function(){Filters.halloween.MASKOBJ3D.add(n),Filters.halloween.MASKOBJ3D.add(t),Filters.halloween.MASKOBJ3D.add(r),Filters.halloween.MASKOBJ3D.scale.multiplyScalar(.59),Filters.halloween.MASKOBJ3D.position.z-=.5,Filters.halloween.MASKOBJ3D.position.y+=.4,a.faceObject.add(Filters.halloween.MASKOBJ3D)};var o,u,l=new THREE.Mesh(a.videoMesh.geometry,(o=(new THREE.TextureLoader).load(Filters.halloween.BASE_URL+"/images/cadre_halloween.png"),u=!0,new THREE.RawShaderMaterial({depthWrite:!1,depthTest:!1,transparent:u,vertexShader:"attribute vec2 position;\n        varying vec2 vUV;\n        void main(void){\n          gl_Position = vec4(position, 0., 1.);\n          vUV = 0.5+0.5*position;\n        }",fragmentShader:"precision lowp float;\n        uniform sampler2D samplerVideo;\n        varying vec2 vUV;\n        void main(void){\n          gl_FragColor = texture2D(samplerVideo, vUV);\n        }",uniforms:{samplerVideo:{value:o}}})));l.renderOrder=999,l.frustumCulled=!1,a.scene.add(l),Filters.halloween.THREECAMERA=THREE.JeelizHelper.create_camera();var s=new THREE.AmbientLight(16777215,.8);a.scene.add(s);var c=new THREE.SpotLight(16777215);c.position.set(100,1e3,100),c.castShadow=!0,a.scene.add(c)},init:function(e){Filters.halloween.MASKOBJ3D=new THREE.Object3D,JeelizResizer.size_canvas({canvasId:"filter-canvas",callback:function(t,r){Filters.halloween.initFaceFilter(r,e)}})},animateSpiders:function(){Filters.halloween.isAnimating=!0,Filters.halloween.ACTIONS.forEach((function(e,t){e.loop=!1,Filters.halloween.MIXERS[t].addEventListener("loop",(function(){e.stop(),e.reset(),Filters.halloween.isAnimating=!1})),e.play()}))},initFaceFilter:function(e,t){JEEFACEFILTERAPI.init({canvasId:"filter-canvas",NNCpath:"./filters/jeelizFaceFilter/dist/",videoSettings:e,callbackReady:function(e,r){e||(Filters.halloween.initThreeScene(r),t&&setTimeout(t,100))},callbackTrack:function(e){Filters.halloween.ISDETECTED=THREE.JeelizHelper.get_isDetected(),Filters.halloween.ISDETECTED&&(e.expressions[0]>=.8&&!Filters.halloween.isAnimating&&Filters.halloween.animateSpiders(),Filters.halloween.MIXERS&&Filters.halloween.MIXERS.length>0&&Filters.halloween.MIXERS.forEach((function(e){e.update(.08)}))),THREE.JeelizHelper.render(e,Filters.halloween.THREECAMERA)}})}},(Filters=window.Filters||{}).deform={BASE_URL:"./filters/jeelizFaceFilter/demos/threejs/faceDeform",THREECAMERA:null,buildMaskMaterial:function(){return new THREE.ShaderMaterial({vertexShader:"varying vec2 vUVvideo;\n  // deformation 0 parameters:\n  const vec2 TEARPOINT0 = vec2(0.,-0.5);\n  const vec2 DISPLACEMENT0 = vec2(0.,0.15);\n  const float RADIUS0 = 0.4;\n  // deformation 1 parameters:\n  const vec2 TEARPOINT1 = vec2(0.25,-0.4);\n  const vec2 DISPLACEMENT1 = vec2(0.12,-0.07);\n  const float RADIUS1 = 0.3;\n  // deformation 2 parameters:\n  const vec2 TEARPOINT2 = vec2(-0.25,-0.4);\n  const vec2 DISPLACEMENT2 = vec2(-0.12,-0.07);\n  const float RADIUS2 = 0.3;\n  void main() {\n    vec3 positionDeformed=position;\n    // apply deformation 0\n    float deformFactor0 = 1.-smoothstep(0.0, RADIUS0, distance(TEARPOINT0, position.xy));\n    positionDeformed.xy += deformFactor0*DISPLACEMENT0;\n    // apply deformation 1\n    float deformFactor1 = 1.-smoothstep(0.0, RADIUS1, distance(TEARPOINT1, position.xy));\n    positionDeformed.xy += deformFactor1*DISPLACEMENT1;\n    // apply deformation 2\n    float deformFactor2 = 1. - smoothstep(0.0, RADIUS2, distance(TEARPOINT2, position.xy));\n    positionDeformed.xy += deformFactor2*DISPLACEMENT2;\n    // project deformed point:\n    vec4 mvPosition = modelViewMatrix * vec4( positionDeformed, 1.0 );\n    vec4 projectedPosition=projectionMatrix * mvPosition;\n    gl_Position=projectedPosition;\n    // compute UV coordinates on the video texture:\n    vec4 mvPosition0 = modelViewMatrix * vec4( position, 1.0 );\n    vec4 projectedPosition0 = projectionMatrix * mvPosition0;\n    vUVvideo = vec2(0.5,0.5) + 0.5*projectedPosition0.xy/projectedPosition0.w;\n  }",fragmentShader:"precision mediump float;\n  uniform sampler2D samplerVideo;\n  varying vec2 vUVvideo;\n  void main() {\n    gl_FragColor = texture2D(samplerVideo, vUVvideo);\n  }",uniforms:{samplerVideo:{value:THREE.JeelizHelper.get_threeVideoTexture()}}})},initThreeScene:function(e){var t=THREE.JeelizHelper.init(e);(new THREE.BufferGeometryLoader).load(Filters.deform.BASE_URL+"/models/faceLowPoly.json",(function(e){e.computeVertexNormals();var r=new THREE.Mesh(e,Filters.deform.buildMaskMaterial());r.frustumCulled=!1,r.scale.multiplyScalar(1.2),r.position.set(0,.2,-.5),t.faceObject.add(r)})),Filters.deform.THREECAMERA=THREE.JeelizHelper.create_camera()},init:function(e){JeelizResizer.size_canvas({canvasId:"filter-canvas",callback:function(t,r){var a=document.querySelector("#wrapper").offsetWidth;Filters.deform.initFaceFilter(_objectSpread(_objectSpread({},r),{},{maxWidth:a}),e)}})},initFaceFilter:function(e,t){JEEFACEFILTERAPI.init({canvasId:"filter-canvas",NNCpath:"./filters/jeelizFaceFilter/dist/",videoSettings:e,callbackReady:function(e,r){if(e&&t)return t(e);Filters.deform.initThreeScene(r),t&&setTimeout(t,100)},callbackTrack:function(e){THREE.JeelizHelper.render(e,Filters.deform.THREECAMERA)}})}},(Filters=window.Filters||{}).liberty={BASE_URL:"./filters/jeelizFaceFilter/demos/threejs/multiLiberty",THREECAMERA:null,SETTINGS:{maxFaces:4},createLibertyMaterial:function(){return new THREE.MeshLambertMaterial({color:11392959,alphaMap:(new THREE.TextureLoader).load(Filters.liberty.BASE_URL+"/assets/libertyAlphaMapSoft512.png"),transparent:!0,premultipliedAlpha:!0})},createFaceMaterial:function(){return new THREE.MeshBasicMaterial({color:6135968,transparent:!0,side:THREE.DoubleSide,premultipliedAlpha:!1,blending:THREE.CustomBlending,blendSrc:THREE.SrcColorFactor,blendDst:THREE.OneFactor,blendEquation:THREE.AddEquation})},initThreeScene:function(e){var t=THREE.JeelizHelper.init(e),r=function(e){e.frustumCulled=!1,e.scale.multiplyScalar(.37),e.position.set(0,.25,.5),t.faceObjects.forEach((function(t){return t.add(e.clone())}))};(new THREE.BufferGeometryLoader).load(Filters.liberty.BASE_URL+"/assets/liberty.json",(function(e){THREE.JeelizHelper.sortFaces(e,"z",!0);var t=new THREE.Mesh(e,Filters.liberty.createLibertyMaterial());t.renderOrder=2,r(t)})),(new THREE.BufferGeometryLoader).load(Filters.liberty.BASE_URL+"/assets/libertyFaceMask.json",(function(e){THREE.JeelizHelper.sortFaces(e,"z",!0);var t=new THREE.Mesh(e,Filters.liberty.createFaceMaterial());t.renderOrder=1,r(t)})),Filters.liberty.THREECAMERA=THREE.JeelizHelper.create_camera();var a=new THREE.AmbientLight(16777215,.5),i=new THREE.DirectionalLight(16777198,.7);i.position.set(0,.05,1),t.scene.add(a,i)},init:function(e){return JEEFACEFILTERAPI.init({canvasId:"filter-canvas",NNCpath:"./filters/jeelizFaceFilter/dist/",maxFacesDetected:Filters.liberty.SETTINGS.maxFaces,callbackReady:function(t,r){t||(Filters.liberty.initThreeScene(r),e&&setTimeout(e,100))},callbackTrack:function(e){THREE.JeelizHelper.render(e,Filters.liberty.THREECAMERA)}})}};